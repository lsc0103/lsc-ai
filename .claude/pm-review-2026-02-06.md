# LSC-AI 平台 — 产品总经理审视报告

**审视人**: Claude Opus 4.6 (产品总经理)
**日期**: 2026-02-06
**审视范围**: 全平台现状 + S04 测试 Review
**信息来源**: 代码仓库全量分析、16份架构文档、.claude 工作记录、3个并行深度分析代理

---

## 一、执行摘要

LSC-AI 是一个**架构设计优秀、但执行存在断层**的企业级 AI 平台。

- 架构完成度高（设计 9/10），但**代码与设计之间存在关键脱节**
- 测试体系建设投入大量精力（169+ 测试用例），但**S04 暴露了本地模式整条链路的系统性问题**
- Mastra 迁移 Phase 1-4 已完成（87.5%），但 Phase 5 测试验证远未闭环
- **核心判断：云端模式基本可用，本地模式（Client Agent）链路断裂，离产品可交付还有实质性差距**

---

## 二、各子系统现状评分

| 子系统 | 代码完成度 | 可用度 | 风险等级 | 关键问题 |
|--------|-----------|--------|---------|---------|
| **Web 前端** | 85% | 75% | 中 | 竞态条件、Workbench 会话绑定仍脆弱 |
| **Server 后端（云端模式）** | 90% | 80% | 低 | P0 已修复，DeepSeek 限流是外部依赖 |
| **Server 后端（本地模式路由）** | 80% | **20%** | **极高** | 历史消息 bug、任务派发链路脆弱 |
| **Client Agent** | 85% | **10%** | **极高** | AI 完全无响应，链路验证为零 |
| **Workbench** | 92% | 75% | 中 | Schema 管道健壮，但 AI 触发不稳定 |
| **Memory** | 90% | 80% | 中 | 云端正常，但本地/云端双存储隔离 |
| **RPA/Workflow** | 后端100% 前端0% | **0%** | 高 | 后端完整但无前端入口，等于不存在 |
| **Sentinel Agent** | 0% | 0% | — | 未开发，仅有数据库 Schema |

---

## 三、S04 测试 Review — 深度分析

### 3.1 测试结果：1/8 通过

| 测试 | 结果 | 判定 |
|------|------|------|
| S04-01 云端→本地→云端上下文连贯 | FAIL | 本地模式 AI 无响应 + 历史切片 bug |
| S04-02 本地模式 + Workbench | FAIL | 同上，根本进不到 Workbench 阶段 |
| S04-03 本地模式多轮上下文 | FAIL | 同上 |
| S04-04 切换会话本地模式保持 | FAIL | 本地模式 AI 无响应 |
| S04-05 刷新页面状态恢复 | **PASS** | 纯前端状态（Zustand persist），不涉及 AI |
| S04-06 切回旧会话本地模式生效 | FAIL | 本地模式 AI 无响应 |
| S04-07 无 Agent 提示 | SKIP | Agent 在线无法测试（设计合理） |
| S04-08 退出本地→云端回复 | FAIL | 本地模式阶段就失败了 |

### 3.2 根因分析 — 5 层问题叠加

**第 1 层：chat.gateway.ts:626 — P0-2 修复不完整**

云端模式路径（line 329）已修复，但本地模式路径（line 626）被遗漏。
`history.slice(0, -1)` 会丢掉最后一条历史消息。

**第 2 层：任务派发链路 — 无错误回传**

AgentGateway.sendTaskToAgent() 是 fire-and-forget，无 ACK、无超时、无清理机制。

**第 3 层：Client Agent executor.ts — 工作目录上下文注入缺陷**

Workbench 上下文只拼接到用户消息字符串，不注入系统提示词。

**第 4 层：双 Memory 存储 — 模式切换后上下文断裂**

Platform Memory 和 Client Agent Memory 完全隔离，跨模式上下文不可能连贯。

**第 5 层：Agent 在线状态判断不可靠**

数据库 status 不等于实时 Socket 连接状态。

### 3.3 对本地工程师（Opus 4.5）的评价

- 测试设计质量：**优秀**
- 辅助函数质量：**良好**
- 执行报告质量：**不合格** — 只报告表象，未追根因
- P0-2 修复质量：**严重遗漏** — 只修了云端路径，遗漏本地路径

---

## 四、全平台风险地图

### 红色风险（阻断交付）

1. 本地模式链路断裂（Frontend→Server→AgentGateway→ClientAgent→回传）
2. P0-2 修复不完整（chat.gateway.ts:626）
3. 双 Memory 隔离（架构缺陷）
4. RPA/Workflow 无前端（后端完整但用户无法使用）

### 黄色风险（降低质量）

5. AgentNetwork 未自动触发
6. Platform MCP 未接入
7. 项目感知被注释
8. AI 行为不确定性（Workbench 工具调用）
9. DeepSeek 限流

### 绿色（已稳定）

10. 云端模式核心对话
11. Workbench Schema 管道
12. 前端 UI 交互
13. 34 个 Server 工具
14. Memory 持久化（云端模式内）

---

## 五、进度数据修正

CLAUDE.md 标记"总进度 73%（103/141）"过于乐观。

按可用度重新评估：**实际可用度约 58%**

| 模块 | 标记完成 | 实际评估 | 差距原因 |
|------|---------|---------|---------|
| 基础框架 | 100% | 95% | Docker 未验证生产环境 |
| Mastra 集成 | 94% | 70% | AgentNetwork/MCP/ProjectContext 未接线 |
| 前端页面 | 83% | 75% | Tasks/RPA 页面是空壳 |
| 对话功能 | 83% | 65% | 本地模式对话完全不可用 |
| Workbench | 95% | 85% | AI 触发不稳定 |
| 用户权限 | 67% | 50% | RBAC UI 缺失 |
| 任务调度 | 53% | 25% | 有后端无前端 = 用户不可用 |
| Client Agent | 90% | 40% | 代码存在但链路不通 |
| 系统监管 | 33% | 0% | Sentinel 完全未开发 |

---

## 六、下一步行动计划

### 立即执行（本周内）

| 优先级 | 任务 | 预计工时 |
|--------|------|---------|
| P0 | 修复 chat.gateway.ts:626 本地模式历史切片 bug | 0.5h |
| P0 | 排查 Client Agent executor AI 调用链路 | 2h |
| P0 | AgentGateway.sendTaskToAgent 加 ACK + 超时 | 2h |
| P0 | S04 二次执行全量回归 | 1h |
| P1 | 启用 AgentNetwork 自动路由 | 1h |
| P1 | 取消注释项目感知注入 | 0.5h |

### 短期（下周）

- Memory 统一方案设计
- Structured Output 引入
- RPA/Task 前端最小可用
- Platform MCP 接入

### 中期（2-4 周）

- Sentinel Agent MVP
- RAG 知识库
- IDP 智能文档
- 多 LLM 支持

---

## 七、对团队的要求

1. 发现问题要自主追到根因，不接受"AI 无响应"这种表面描述
2. 修 bug 必须全局搜索同类代码路径，确认所有分支都修到
3. "标记完成"要有验证，没有通过测试的功能状态应为"待验证"
4. 架构缺陷要上报，不能只埋头写代码

---

## 八、结论

LSC-AI 平台架构愿景优秀，核心能力有潜力，但当前离"可交付产品"还有明显差距。

核心策略：**不要再写新功能，先把已有的东西跑通、测通、修通。**
