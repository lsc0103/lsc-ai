# PM 指令：深度产品验收方案 (Phase H)

**签发人**：PM (Opus 4.6)
**日期**：2026-02-07
**背景**：Phase G 基础验收已通过（5/6 链路），P0-7~P0-10 修复已验证。现进入深度验收，确保当前迭代所有已实现功能的业务流程完整闭环。

---

## 验收原则

1. **只测已实现的功能**：未实现的（RPA 前端、RAG 知识库、IDP 文档处理、Sentinel Agent、权限管理、系统监控）不在本轮范围
2. **按用户视角验证**：不是"函数被调用"，而是"用户需求被满足"
3. **参考架构文档**：Workbench 16 个应用场景中可测的场景必须覆盖
4. **发现问题立即记录**：不掩饰、不绕过

---

## 执行方式建议

**建议组建 Agent Team**。本次验收共 8 个模块、约 40 个测试点，单人执行容易疲劳导致判断失误（Phase G 第一轮已有教训）。具体团队规模和分工由总工程师根据实际情况自行规划。

---

## 模块 DV-1：对话系统深度验证（6 项）

验证对话系统在真实使用中的表现，不是简单的"发一条消息收一条回复"。

| 编号 | 测试场景 | 用户操作 | 通过标准 |
|------|---------|---------|---------|
| DV-1.1 | 多轮上下文连贯 | 5 轮对话，第 5 轮引用第 1 轮信息 | AI 正确回忆第 1 轮内容，不混淆 |
| DV-1.2 | 文件附件分析 | 上传一张图片，问 AI 图片内容 | AI 正确描述图片内容（DeepSeek 不支持图片则记录为已知限制） |
| DV-1.3 | 流式中断恢复 | AI 生成长回复时点击停止，然后发新消息 | 停止生效，新消息正常收到回复 |
| DV-1.4 | 代码块渲染 | 让 AI 写一段包含 3 种语言的代码（Python、SQL、TypeScript） | 3 个代码块都有语法高亮，语言标签正确 |
| DV-1.5 | 工具调用步骤展示 | 让 AI 执行需要多个工具的复杂任务 | 工具步骤折叠展示（Claude 风格），展开可看到工具名和参数 |
| DV-1.6 | 超长消息处理 | 让 AI 生成 2000 字以上的回复 | 回复完整显示，不截断，滚动正常 |

---

## 模块 DV-2：Workbench 内容类型覆盖（8 项）

验证 Workbench 12+ 内容组件的渲染能力。每种类型至少测一次，确保 AI 能正确生成 schema、前端能正确渲染。

| 编号 | 内容类型 | 用户输入示例 | 通过标准 |
|------|---------|------------|---------|
| DV-2.1 | DataTable 数据表格 | "用表格展示中国前5大城市的人口、GDP、面积" | 表格渲染，列头正确，数据 5 行，支持排序 |
| DV-2.2 | BarChart 柱状图 | "用柱状图展示上面的 GDP 数据" | ECharts 柱状图渲染，X 轴城市名，Y 轴 GDP 值 |
| DV-2.3 | LineChart 折线图 | "用折线图展示 2020-2025 年公司营收趋势" | 折线图渲染，6 个数据点，有数值标签 |
| DV-2.4 | PieChart 饼图 | "用饼图展示各部门的预算占比" | 饼图渲染，图例可见，百分比标签 |
| DV-2.5 | CodeEditor 代码 | "在工作台展示一段完整的 React 组件代码" | Monaco 编辑器渲染，JSX/TSX 语法高亮 |
| DV-2.6 | Markdown 文档 | "在工作台写一篇关于项目管理的文章，要有标题、列表、表格" | Markdown 渲染正确，标题层级/列表/表格都显示 |
| DV-2.7 | 复合多 Tab | "工作台同时展示：一个表格、一个柱状图、一段代码" | 3 个 Tab，分别渲染表格、图表、代码，Tab 切换正常 |
| DV-2.8 | 统计卡片 + 表格 | "展示本月销售概况：总额、增长率、订单数的统计卡片，加上明细表格" | 统计卡片（数字+趋势）+ 表格同时渲染 |

---

## 模块 DV-3：Workbench 交互能力（6 项）

验证 Workbench 作为"协作工作空间"的交互功能，不只是看能不能显示内容。

| 编号 | 交互功能 | 操作步骤 | 通过标准 |
|------|---------|---------|---------|
| DV-3.1 | Tab 管理 | AI 生成 3 Tab 内容 → 关闭第 2 个 → 确认只剩 2 个 | Tab 关闭成功，剩余 Tab 内容不丢失 |
| DV-3.2 | 分屏拖拽 | 拖动 resizer 调整聊天/Workbench 宽度比 | 宽度可调，约束在 25%-75% 范围内 |
| DV-3.3 | 关闭重开 | 关闭 Workbench → 发新请求触发重新打开 | 关闭成功，重开后显示新内容 |
| DV-3.4 | 会话切换保持 | 会话 A 有 Workbench 内容 → 切到会话 B → 切回会话 A | 会话 A 的 Workbench 内容完整恢复 |
| DV-3.5 | 新建会话清空 | 有 Workbench 内容时 → 新建对话 | Workbench 被清空或关闭，不显示旧内容 |
| DV-3.6 | AI 追加内容 | 已有 Workbench → 让 AI 再生成一个内容 | 新内容以新 Tab 追加，旧 Tab 保留 |

---

## 模块 DV-4：Office 文档完整流程（5 项）

验证 Office 文档从创建到编辑到读取的完整生命周期，不是只测单个工具。

| 编号 | 流程 | 操作步骤 | 通过标准 |
|------|------|---------|---------|
| DV-4.1 | Word 全流程 | 创建 Word → 追加内容 → 读取验证 | 文档生成，追加成功，读取内容包含原始+追加 |
| DV-4.2 | Excel 结构化数据 | 创建 Excel（3 列 × 5 行） → 读取验证 | .xlsx 生成，readOffice 能读取，数据结构正确 |
| DV-4.3 | PDF 报告 | 生成包含标题、段落、表格的 PDF | .pdf 生成，文件大小 > 0 |
| DV-4.4 | 多文档联动 | "先创建 Word 项目报告，再创建 Excel 数据附件，最后生成 PDF 汇总" | 3 个文档都生成（需隔离限流，每步间隔 30 秒） |
| DV-4.5 | 文档内容质量 | 让 AI 创建一份有实际业务含义的文档（如"船舶改造项目验收报告"） | 文档内容有结构、有细节，不是敷衍的模板 |

---

## 模块 DV-5：本地 Agent 深度验证（7 项）

Phase G 的 BF-4 只测了基础 CRUD。本模块要测本地 Agent 的实际项目级能力。

| 编号 | 测试场景 | 用户操作 | 通过标准 |
|------|---------|---------|---------|
| DV-5.1 | 目录结构创建 | "在当前目录创建一个 test-project 文件夹，里面建 src 和 docs 两个子目录" | mkdir 成功，ls 确认 3 级目录结构正确 |
| DV-5.2 | 多文件项目构建 | "在 test-project/src 下创建 index.ts 和 utils.ts，写入实际代码" | 两个文件创建成功，内容是有效的 TypeScript 代码 |
| DV-5.3 | 文件读取与分析 | "读取 test-project/src/index.ts，分析代码质量" | AI 读到文件内容并给出有意义的分析 |
| DV-5.4 | 文件编辑 | "在 index.ts 里添加一个导出函数" | edit 工具成功修改文件，AI 确认修改内容 |
| DV-5.5 | Shell 命令执行 | "运行 ls -la 看看 test-project 的详细信息" | bash 工具执行成功，返回文件列表和权限信息 |
| DV-5.6 | 项目清理 | "删除整个 test-project 目录" | rm 成功删除目录及内容 |
| DV-5.7 | 错误处理 | "读取一个不存在的文件 /tmp/nonexistent.txt" | AI 报告文件不存在，不崩溃，给出建议 |

---

## 模块 DV-6：多 Agent 协作验证（3 项）

验证 AgentNetwork 多 Agent 路由能力（4 个 Agent：Platform、Code Expert、Data Analyst、Office Worker）。

| 编号 | 测试场景 | 用户操作 | 通过标准 |
|------|---------|---------|---------|
| DV-6.1 | Agent 路由识别 | 分别发送"写一段代码"和"分析这组数据"，观察工具调用差异 | 不同类型的请求触发不同的工具调用模式 |
| DV-6.2 | Network 模式对话 | 启用 Network 模式，发送"帮我分析销售数据并生成报表" | AI 调用多个工具完成复合任务 |
| DV-6.3 | 模式切换 | 云端模式 → 本地模式 → 发消息 → 云端模式 | 每次切换后消息路由到正确的 Agent |

---

## 模块 DV-7：记忆与会话管理（5 项）

验证 Memory 系统和会话管理的完整性。

| 编号 | 测试场景 | 操作步骤 | 通过标准 |
|------|---------|---------|---------|
| DV-7.1 | Working Memory 持久化 | 告诉 AI"记住我叫张三，是产品经理" → 新消息问"我是谁" | AI 回忆出用户名和角色 |
| DV-7.2 | 会话隔离 | 会话 A 聊项目 → 新建会话 B → 问 AI 上下文 | 会话 B 不知道会话 A 的内容 |
| DV-7.3 | 历史消息恢复 | 发 5 条消息 → 刷新页面 → 检查消息列表 | 5 条消息全部恢复，内容完整 |
| DV-7.4 | 会话删除 | 删除一个有消息的会话 | 会话从侧边栏消失，消息被清理 |
| DV-7.5 | 跨会话 Memory 隔离 | 会话 A 设置偏好"用中文" → 会话 B 检查 | 会话 B 不继承会话 A 的 Working Memory（如果当前是隔离的），或正确共享（如果设计为共享） |

---

## 模块 DV-8：端到端业务场景（3 项）

模拟真实用户的完整工作流，不是单步测试。每个场景跨越多个功能模块。

| 编号 | 业务场景 | 完整流程 | 通过标准 |
|------|---------|---------|---------|
| DV-8.1 | 数据分析工作流 | ① 问 AI 季度销售数据 → ② Workbench 展示表格 → ③ 追问"用图表展示" → ④ Workbench 追加图表 Tab → ⑤ "生成分析报告 Word" → ⑥ 文档生成 | 全流程 6 步闭环，Workbench 有表格+图表，Word 文档生成 |
| DV-8.2 | 本地开发工作流 | ① 进入本地模式 → ② 创建项目目录结构 → ③ 写入代码文件 → ④ 读取验证 → ⑤ 在 Workbench 展示代码 → ⑥ 退出本地模式 | 全流程闭环，本地文件系统和 Workbench 协同工作 |
| DV-8.3 | 文档生成 + Workbench 展示 | ① 让 AI 创建项目周报 Word → ② 在 Workbench 展示周报内容预览 → ③ 追问修改 → ④ Workbench 更新 | AI 能在 Workbench 预览文档内容，且支持迭代修改 |

---

## 报告格式要求

每个模块提交：
1. **测试结果表**：编号 | 结果(✅/❌) | 实际表现 | 耗时
2. **关键截图**：每个测试点至少 1 张
3. **发现的问题**：如有失败，记录根因分析
4. **AI 原始回复**：保留 AI 的完整回复文本

文件提交到 `bf-reports/deep-validation/` 目录。

---

## 判定标准

| 模块 | 测试点数 | 最低通过数 | 说明 |
|------|---------|-----------|------|
| DV-1 对话系统 | 6 | 5/6 | DV-1.2（图片）可能受 DeepSeek 限制 |
| DV-2 Workbench 内容 | 8 | 7/8 | 每种内容类型至少 1 个必须能渲染 |
| DV-3 Workbench 交互 | 6 | 5/6 | 交互功能是核心竞争力 |
| DV-4 Office 文档 | 5 | 4/5 | DV-4.4 可能受限流影响 |
| DV-5 本地 Agent | 7 | 6/7 | 项目级操作是关键差异化 |
| DV-6 多 Agent | 3 | 2/3 | Network 模式可能未完全开放 |
| DV-7 记忆管理 | 5 | 4/5 | BF-5 已知 Memory 有问题 |
| DV-8 端到端 | 3 | 2/3 | 允许 1 个场景因限流失败 |
| **总计** | **43** | **35/43 (81%)** | |

**全部模块达到最低通过数 → 当前迭代验收通过，可进入下一阶段开发。**
**任一模块未达标 → 修复后重测该模块。**

---

## 注意事项

1. **DeepSeek 限流管理**：Office 工具和长对话容易触发限流，每个需要 AI 调用工具的测试之间至少间隔 15 秒
2. **本地 Agent 环境**：DV-5 需要确认 Client Agent 已 rebuild 且在线
3. **截图时机**：在 AI 完成回复后截图，不要在流式传输过程中截
4. **真实判断**：如果 AI 回复了但内容是错误的或无意义的，标记为 ❌
