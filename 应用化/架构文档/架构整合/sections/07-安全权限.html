<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07 - 安全与权限</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="../assets/mermaid.min.js"></script>
</head>
<body>
<div class="section-page">
    <div class="section-header">
        <h2>07 - 安全与权限</h2>
        <div class="meta">文档版本：1.0 | 更新日期：2026-01-19</div>
    </div>

    <h3>一、安全架构总览</h3>

    <div class="arch-diagram">
        <div class="arch-title">安全架构分层</div>

        <!-- 网络安全层 -->
        <div class="arch-layer" style="border-color: #fa541c; margin-bottom: 12px;">
            <span class="layer-title" style="color: #fa541c;">网络安全层</span>
            <div class="layer-content">
                <div class="arch-box"><div class="arch-box-title">HTTPS 强制</div></div>
                <div class="arch-box"><div class="arch-box-title">内网隔离</div></div>
                <div class="arch-box"><div class="arch-box-title">防火墙规则</div></div>
            </div>
        </div>

        <div class="connector">|</div>

        <!-- 认证层 -->
        <div class="arch-layer" style="border-color: #1890ff; margin-bottom: 12px;">
            <span class="layer-title" style="color: #1890ff;">认证层</span>
            <div class="layer-content">
                <div class="arch-box primary"><div class="arch-box-title">JWT Token</div></div>
                <div class="arch-box primary"><div class="arch-box-title">SSO/LDAP 集成</div></div>
                <div class="arch-box primary"><div class="arch-box-title">多因素认证</div><div class="arch-box-desc">可选</div></div>
            </div>
        </div>

        <div class="connector">|</div>

        <!-- 授权层 -->
        <div class="arch-layer" style="border-color: #52c41a; margin-bottom: 12px;">
            <span class="layer-title" style="color: #52c41a;">授权层</span>
            <div class="layer-content">
                <div class="arch-box"><div class="arch-box-title">RBAC 角色权限</div></div>
                <div class="arch-box"><div class="arch-box-title">资源级权限</div></div>
                <div class="arch-box"><div class="arch-box-title">API 级权限</div></div>
            </div>
        </div>

        <div class="connector">|</div>

        <!-- 数据安全层 -->
        <div class="arch-layer" style="border-color: #722ed1; margin-bottom: 12px;">
            <span class="layer-title" style="color: #722ed1;">数据安全层</span>
            <div class="layer-content">
                <div class="arch-box"><div class="arch-box-title">数据加密存储</div></div>
                <div class="arch-box"><div class="arch-box-title">传输加密</div></div>
                <div class="arch-box"><div class="arch-box-title">敏感数据脱敏</div></div>
            </div>
        </div>

        <div class="connector">|</div>

        <!-- 审计层 -->
        <div class="arch-layer" style="border-color: #faad14;">
            <span class="layer-title" style="color: #faad14;">审计层</span>
            <div class="layer-content">
                <div class="arch-box warning"><div class="arch-box-title">操作日志记录</div></div>
                <div class="arch-box warning"><div class="arch-box-title">异常行为检测</div></div>
                <div class="arch-box warning"><div class="arch-box-title">安全告警</div></div>
            </div>
        </div>
    </div>

    <h3>二、认证机制</h3>

    <h4>2.1 JWT 认证流程</h4>
    <div class="mermaid">
sequenceDiagram
    participant User as 用户
    participant Backend as LSC-AI 后端
    participant DB as 数据库

    User->>Backend: 1. POST /api/auth/login<br/>{username, password}
    Backend->>DB: 2. 查询用户
    DB-->>Backend: 返回用户信息
    Backend->>Backend: 3. 比对密码 hash
    Backend-->>User: 4. 返回 Token<br/>{accessToken, refreshToken}

    Note over User,Backend: 后续请求

    User->>Backend: 5. 请求 + Authorization: Bearer Token
    Backend->>Backend: 6. 验证 Token + 检查权限
    Backend-->>User: 7. 执行请求并返回结果
    </div>

    <h4>2.2 JWT Token 设计</h4>
    <div class="grid-2">
        <div>
            <h5>Access Token 结构</h5>
            <pre><code>interface AccessTokenPayload {
  sub: string;        // 用户 ID
  username: string;   // 用户名
  roles: string[];    // 角色列表
  permissions: string[]; // 权限列表
  iat: number;        // 签发时间
  exp: number;        // 过期时间 (15 分钟)
}</code></pre>
        </div>
        <div>
            <h5>Refresh Token 结构</h5>
            <pre><code>interface RefreshTokenPayload {
  sub: string;        // 用户 ID
  jti: string;        // Token ID (用于撤销)
  iat: number;        // 签发时间
  exp: number;        // 过期时间 (7 天)
}</code></pre>
        </div>
    </div>

    <h4>2.3 Token 刷新机制</h4>
    <div class="mermaid">
flowchart TD
    A[Access Token 过期<br/>15分钟] --> B[前端检测到 401 Unauthorized]
    B --> C[POST /api/auth/refresh<br/>携带 refreshToken]
    C --> D{Refresh Token 有效?}
    D -->|是| E[返回新 Access Token]
    D -->|否| F[跳转登录页]
    E --> G[继续执行原请求]
    </div>

    <h4>2.4 SSO 集成方案</h4>
    <div class="tip-box info">
        <h5 style="margin-bottom: 12px;">支持的 SSO 协议</h5>
        <ul>
            <li><strong>LDAP / Active Directory</strong> - 企业内部认证</li>
            <li><strong>OAuth 2.0 / OIDC</strong> - 第三方认证</li>
            <li><strong>SAML 2.0</strong> - 企业级单点登录</li>
        </ul>
    </div>

    <p><strong>LDAP 配置示例：</strong></p>
    <pre><code>{
  "type": "ldap",
  "url": "ldap://ad.company.com:389",
  "baseDN": "dc=company,dc=com",
  "bindDN": "cn=admin,dc=company,dc=com",
  "bindPassword": "***",
  "searchFilter": "(sAMAccountName={{username}})"
}</code></pre>

    <h3>三、混合权限模型</h3>

    <p>采用 <strong>RBAC + 用户级覆盖</strong> 的混合模型，兼顾管理效率和灵活性。</p>

    <h4>3.1 权限模型架构</h4>
    <div class="arch-diagram">
        <div class="arch-title">混合权限模型</div>
        <div style="text-align: center; padding: 20px;">
            <div class="arch-box" style="display: inline-block; min-width: 150px;">
                <div class="arch-box-title">用户</div>
            </div>
            <div class="connector" style="margin: 12px 0;">|</div>
            <div style="display: flex; justify-content: center; gap: 20px; margin: 16px 0;">
                <div class="arch-box primary">
                    <div class="arch-box-title">角色权限</div>
                    <div class="arch-box-desc">批量管理</div>
                </div>
                <div class="arch-box" style="border-color: #52c41a;">
                    <div class="arch-box-title">额外授权 (grant)</div>
                    <div class="arch-box-desc">个别增加</div>
                </div>
                <div class="arch-box" style="border-color: #ff4d4f;">
                    <div class="arch-box-title">权限禁用 (deny)</div>
                    <div class="arch-box-desc">个别限制</div>
                </div>
            </div>
            <div class="connector" style="margin: 12px 0;">|</div>
            <div class="arch-box warning" style="display: inline-block; min-width: 200px;">
                <div class="arch-box-title">最终权限</div>
            </div>
        </div>
    </div>

    <h4>3.2 权限计算规则</h4>
    <div class="tip-box warning">
        <h5 style="margin-bottom: 12px;">权限计算公式</h5>
        <pre><code>最终权限 = (角色1 权限 ∪ 角色2 权限 ∪ ...) ∪ 额外授权 - 权限禁用</code></pre>
        <p style="margin-top: 12px;"><strong>优先级：</strong>deny (禁用) > grant (授权) > role (角色)</p>
    </div>

    <h4>3.3 权限分类</h4>
    <div class="grid-2">
        <div>
            <h5>平台功能权限 (LSC-AI 内部)</h5>
            <ul>
                <li><code>chat:*</code> - 对话相关</li>
                <li><code>workbench:*</code> - 工作台</li>
                <li><code>project:*</code> - 项目管理</li>
                <li><code>task:*</code> - 定时任务</li>
                <li><code>rpa:*</code> - RPA 流程</li>
                <li><code>credential:*</code> - 凭证管理</li>
                <li><code>admin:*</code> - 系统管理</li>
                <li><code>monitor:*</code> - 系统监管</li>
            </ul>
        </div>
        <div>
            <h5>业务系统权限 (外部系统)</h5>
            <ul>
                <li><code>mes:read/write/admin</code> - MES 系统</li>
                <li><code>oa:read/write/admin</code> - OA 系统</li>
                <li><code>wms:read/write/admin</code> - WMS 系统</li>
                <li><code>qms:read/write/admin</code> - QMS 系统</li>
                <li><code>server:*:read/manage</code> - 服务器管理</li>
            </ul>
        </div>
    </div>

    <h4>3.4 权限判断流程</h4>
    <div class="mermaid">
flowchart TD
    A[API 请求] --> B{用户已认证?}
    B -->|否| C[返回 401 Unauthorized]
    B -->|是| D{是否超级管理员?}
    D -->|是| E[允许访问]
    D -->|否| F{检查权限禁用列表}
    F -->|命中禁用| G[返回 403 Forbidden]
    F -->|未命中| H{检查额外授权}
    H -->|有授权| E
    H -->|无授权| I{检查角色权限}
    I -->|有权限| E
    I -->|无权限| J{检查通配符权限}
    J -->|匹配 module:*| E
    J -->|不匹配| G
    </div>

    <h3>四、预设角色与权限清单</h3>

    <table>
        <thead>
            <tr>
                <th>角色名称</th>
                <th>角色标识</th>
                <th>描述</th>
                <th>权限范围</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>超级管理员</strong></td>
                <td><code>admin</code></td>
                <td>拥有所有权限</td>
                <td><code>*</code> (所有权限)</td>
            </tr>
            <tr>
                <td><strong>系统管理员</strong></td>
                <td><code>sys_admin</code></td>
                <td>系统配置与用户管理</td>
                <td><code>admin:user</code>, <code>admin:role</code>, <code>admin:system</code>, <code>admin:audit</code>, <code>monitor:*</code></td>
            </tr>
            <tr>
                <td><strong>开发者</strong></td>
                <td><code>developer</code></td>
                <td>完整功能使用</td>
                <td><code>chat:*</code>, <code>workbench:*</code>, <code>project:*</code>, <code>task:*</code>, <code>rpa:*</code></td>
            </tr>
            <tr>
                <td><strong>普通用户</strong></td>
                <td><code>user</code></td>
                <td>基础功能使用</td>
                <td><code>chat:create</code>, <code>chat:read</code>, <code>workbench:use</code>, <code>project:read</code></td>
            </tr>
            <tr>
                <td><strong>只读用户</strong></td>
                <td><code>viewer</code></td>
                <td>仅查看权限</td>
                <td><code>chat:read</code>, <code>workbench:use</code> (只读)</td>
            </tr>
            <tr>
                <td><strong>运维人员</strong></td>
                <td><code>ops</code></td>
                <td>监控查看</td>
                <td><code>monitor:*</code>, <code>server:*:read</code></td>
            </tr>
            <tr>
                <td><strong>运维管理员</strong></td>
                <td><code>ops_admin</code></td>
                <td>服务器管理</td>
                <td><code>monitor:*</code>, <code>server:*:manage</code></td>
            </tr>
        </tbody>
    </table>

    <h4>功能权限详细清单</h4>
    <pre><code>// 功能权限定义
const FunctionalPermissions = {
  // 对话相关
  'chat:create': '创建对话',
  'chat:read': '查看对话',
  'chat:delete': '删除对话',

  // 工作台
  'workbench:use': '使用工作台',
  'workbench:export': '导出内容',

  // 项目管理
  'project:create': '创建项目',
  'project:read': '查看项目',
  'project:update': '编辑项目',
  'project:delete': '删除项目',

  // RPA/定时任务
  'task:create': '创建任务',
  'task:read': '查看任务',
  'task:update': '编辑任务',
  'task:delete': '删除任务',
  'task:execute': '执行任务',

  // RPA 流程
  'rpa:create': '创建 RPA 流程',
  'rpa:read': '查看 RPA 流程',
  'rpa:update': '编辑 RPA 流程',
  'rpa:delete': '删除 RPA 流程',
  'rpa:execute': '执行 RPA 流程',

  // 凭证管理
  'credential:create': '创建凭证',
  'credential:read': '查看凭证',
  'credential:update': '编辑凭证',
  'credential:delete': '删除凭证',

  // 系统管理
  'admin:user': '用户管理',
  'admin:role': '角色管理',
  'admin:system': '系统配置',
  'admin:audit': '审计日志',

  // 系统监管
  'monitor:server': '服务器监控',
  'monitor:service': '服务管理',
  'monitor:restart': '重启服务',
};</code></pre>

    <h3>五、资源权限控制</h3>

    <h4>5.1 业务系统资源权限</h4>
    <table>
        <thead>
            <tr>
                <th>业务系统</th>
                <th>权限标识</th>
                <th>权限说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="3"><strong>MES 系统</strong></td>
                <td><code>mes:read</code></td>
                <td>MES 系统只读访问</td>
            </tr>
            <tr>
                <td><code>mes:write</code></td>
                <td>MES 系统读写操作</td>
            </tr>
            <tr>
                <td><code>mes:admin</code></td>
                <td>MES 系统管理权限</td>
            </tr>
            <tr>
                <td rowspan="3"><strong>OA 系统</strong></td>
                <td><code>oa:read</code></td>
                <td>OA 系统只读访问</td>
            </tr>
            <tr>
                <td><code>oa:write</code></td>
                <td>OA 系统读写操作</td>
            </tr>
            <tr>
                <td><code>oa:admin</code></td>
                <td>OA 系统管理权限</td>
            </tr>
            <tr>
                <td rowspan="3"><strong>WMS 系统</strong></td>
                <td><code>wms:read</code></td>
                <td>WMS 系统只读访问</td>
            </tr>
            <tr>
                <td><code>wms:write</code></td>
                <td>WMS 系统读写操作</td>
            </tr>
            <tr>
                <td><code>wms:admin</code></td>
                <td>WMS 系统管理权限</td>
            </tr>
            <tr>
                <td rowspan="3"><strong>QMS 系统</strong></td>
                <td><code>qms:read</code></td>
                <td>QMS 系统只读访问</td>
            </tr>
            <tr>
                <td><code>qms:write</code></td>
                <td>QMS 系统读写操作</td>
            </tr>
            <tr>
                <td><code>qms:admin</code></td>
                <td>QMS 系统管理权限</td>
            </tr>
            <tr>
                <td rowspan="2"><strong>服务器管理</strong></td>
                <td><code>server:*:read</code></td>
                <td>服务器只读查看</td>
            </tr>
            <tr>
                <td><code>server:*:manage</code></td>
                <td>服务器管理操作</td>
            </tr>
        </tbody>
    </table>

    <h4>5.2 权限检查代码实现</h4>
    <pre><code>// 权限检查中间件
@Injectable()
export class PermissionGuard implements CanActivate {
  async canActivate(context: ExecutionContext): Promise&lt;boolean&gt; {
    const request = context.switchToHttp().getRequest();
    const user = request.user;
    const requiredPermissions = this.getRequiredPermissions(context);

    // 超级管理员跳过检查
    if (user.roles.includes('admin')) {
      return true;
    }

    // 检查是否拥有所需权限
    for (const permission of requiredPermissions) {
      if (!this.hasPermission(user, permission)) {
        throw new ForbiddenException(`缺少权限: ${permission}`);
      }
    }

    return true;
  }

  private hasPermission(user: User, permission: string): boolean {
    // 检查用户权限列表
    if (user.permissions.includes(permission)) {
      return true;
    }

    // 检查通配符权限
    const [module, action] = permission.split(':');
    if (user.permissions.includes(`${module}:*`)) {
      return true;
    }

    return false;
  }
}

// 使用示例
@Controller('tasks')
export class TaskController {
  @Post()
  @RequirePermissions('task:create')
  async createTask(@Body() dto: CreateTaskDto) {
    // ...
  }

  @Delete(':id')
  @RequirePermissions('task:delete')
  async deleteTask(@Param('id') id: string) {
    // ...
  }
}</code></pre>

    <h3>六、操作审计日志</h3>

    <h4>6.1 审计事件类型</h4>
    <div class="grid-2">
        <div>
            <h5>认证与用户相关</h5>
            <ul>
                <li><code>auth.login</code> - 用户登录</li>
                <li><code>auth.logout</code> - 用户登出</li>
                <li><code>auth.login_failed</code> - 登录失败</li>
                <li><code>auth.password_changed</code> - 密码修改</li>
                <li><code>admin.user_created</code> - 创建用户</li>
                <li><code>admin.user_deleted</code> - 删除用户</li>
                <li><code>admin.role_changed</code> - 角色变更</li>
            </ul>
        </div>
        <div>
            <h5>业务操作相关</h5>
            <ul>
                <li><code>chat.created</code> - 创建对话</li>
                <li><code>chat.deleted</code> - 删除对话</li>
                <li><code>task.created</code> - 创建任务</li>
                <li><code>task.executed</code> - 执行任务</li>
                <li><code>rpa.executed</code> - 执行 RPA</li>
                <li><code>rpa.failed</code> - RPA 失败</li>
                <li><code>file.read/write/delete</code> - 文件操作</li>
                <li><code>ops.server_restart</code> - 服务器重启</li>
            </ul>
        </div>
    </div>

    <h4>6.2 审计日志结构</h4>
    <pre><code>interface AuditLog {
  id: string;
  timestamp: Date;
  userId: string;
  username: string;
  action: AuditAction;
  resourceType?: string;
  resourceId?: string;
  details: {
    before?: any;     // 修改前的值
    after?: any;      // 修改后的值
    params?: any;     // 操作参数
    result?: string;  // 操作结果
  };
  ipAddress: string;
  userAgent: string;
  sessionId: string;
  success: boolean;
  errorMessage?: string;
}</code></pre>

    <h4>6.3 审计日志查询界面</h4>
    <div class="arch-diagram">
        <div class="arch-title">审计日志查询</div>
        <div style="padding: 16px;">
            <div style="background: var(--bg-light); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                <strong>筛选条件：</strong>
                用户: [全部] | 操作类型: [全部] | 时间范围: [今天] | [搜索]
            </div>
            <table>
                <thead>
                    <tr>
                        <th>时间</th>
                        <th>用户</th>
                        <th>操作</th>
                        <th>资源</th>
                        <th>结果</th>
                        <th>IP</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2026-01-19 10:30:25</td>
                        <td>zhangsan</td>
                        <td>执行RPA任务</td>
                        <td>OA日志填报</td>
                        <td style="color: #52c41a;">成功</td>
                        <td>192.168.1.100</td>
                    </tr>
                    <tr>
                        <td>2026-01-19 10:15:00</td>
                        <td>lisi</td>
                        <td>创建对话</td>
                        <td>session-xxx</td>
                        <td style="color: #52c41a;">成功</td>
                        <td>192.168.1.101</td>
                    </tr>
                    <tr>
                        <td>2026-01-19 10:00:05</td>
                        <td>admin</td>
                        <td>修改用户角色</td>
                        <td>user-xxx</td>
                        <td style="color: #52c41a;">成功</td>
                        <td>192.168.1.1</td>
                    </tr>
                    <tr>
                        <td>2026-01-19 09:45:30</td>
                        <td>wangwu</td>
                        <td>登录失败</td>
                        <td>-</td>
                        <td style="color: #ff4d4f;">失败</td>
                        <td>192.168.1.102</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <h3>七、数据安全</h3>

    <h4>7.1 加密方案总览</h4>
    <div class="grid-3">
        <div class="tip-box info">
            <h5>传输加密</h5>
            <ul style="font-size: 13px; margin-top: 8px;">
                <li>HTTPS (TLS 1.3)</li>
                <li>WebSocket 使用 WSS</li>
                <li>内部服务 mTLS (可选)</li>
            </ul>
        </div>
        <div class="tip-box warning">
            <h5>存储加密</h5>
            <ul style="font-size: 13px; margin-top: 8px;">
                <li>密码：bcrypt (cost=12)</li>
                <li>凭证：AES-256-GCM</li>
                <li>敏感配置：环境变量/Vault</li>
                <li>数据库透明加密 (可选)</li>
            </ul>
        </div>
        <div class="tip-box success">
            <h5>密钥管理</h5>
            <ul style="font-size: 13px; margin-top: 8px;">
                <li>主密钥：环境变量注入</li>
                <li>凭证密钥：PBKDF2 派生</li>
                <li>Token 签名密钥：定期轮换</li>
            </ul>
        </div>
    </div>

    <h4>7.2 凭证加密实现</h4>
    <pre><code>// 凭证加密服务
@Injectable()
export class CredentialEncryptionService {
  private readonly algorithm = 'aes-256-gcm';

  // 加密凭证
  async encrypt(plaintext: string, userKey: string): Promise&lt;string&gt; {
    const key = await this.deriveKey(userKey);
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv(this.algorithm, key, iv);

    let encrypted = cipher.update(plaintext, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    const authTag = cipher.getAuthTag();

    // 返回格式: iv:authTag:encrypted
    return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
  }

  // 解密凭证
  async decrypt(encryptedData: string, userKey: string): Promise&lt;string&gt; {
    const [ivHex, authTagHex, encrypted] = encryptedData.split(':');
    const key = await this.deriveKey(userKey);
    const iv = Buffer.from(ivHex, 'hex');
    const authTag = Buffer.from(authTagHex, 'hex');

    const decipher = crypto.createDecipheriv(this.algorithm, key, iv);
    decipher.setAuthTag(authTag);

    let decrypted = decipher.update(encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');

    return decrypted;
  }

  // 从用户密钥派生加密密钥
  private async deriveKey(userKey: string): Promise&lt;Buffer&gt; {
    return new Promise((resolve, reject) => {
      crypto.pbkdf2(
        userKey,
        process.env.CREDENTIAL_SALT!,
        100000,  // 迭代次数
        32,      // 密钥长度
        'sha256',
        (err, key) => {
          if (err) reject(err);
          else resolve(key);
        }
      );
    });
  }
}</code></pre>

    <h4>7.3 敏感数据脱敏</h4>
    <pre><code>// 日志脱敏规则
const SensitiveFields = [
  'password',
  'token',
  'apiKey',
  'secret',
  'credential',
  'authorization',
];

function maskSensitiveData(obj: any): any {
  if (typeof obj !== 'object' || obj === null) {
    return obj;
  }

  const masked = Array.isArray(obj) ? [] : {};

  for (const [key, value] of Object.entries(obj)) {
    const lowerKey = key.toLowerCase();
    if (SensitiveFields.some(f => lowerKey.includes(f))) {
      masked[key] = '***MASKED***';
    } else if (typeof value === 'object') {
      masked[key] = maskSensitiveData(value);
    } else {
      masked[key] = value;
    }
  }

  return masked;
}</code></pre>

    <h3>八、安全最佳实践</h3>

    <h4>8.1 API 安全措施</h4>
    <pre><code>// 1. 请求限流
@UseGuards(ThrottlerGuard)
@Throttle(100, 60)  // 每分钟 100 次

// 2. 输入验证
@Post()
async createTask(@Body(ValidationPipe) dto: CreateTaskDto) {}

// 3. SQL 注入防护 - 使用 Prisma ORM

// 4. XSS 防护 - 输出编码
import { escape } from 'html-escaper';

// 5. CSRF 防护 - 使用 CSRF Token
@UseGuards(CsrfGuard)</code></pre>

    <h4>8.2 安全检查清单</h4>
    <div class="grid-2">
        <div class="tip-box warning">
            <h5 style="margin-bottom: 12px;">认证安全</h5>
            <ul style="font-size: 13px;">
                <li>密码强度策略 (8位以上，含大小写数字特殊字符)</li>
                <li>登录失败锁定 (5次失败锁定30分钟)</li>
                <li>Session 超时 (无操作30分钟自动登出)</li>
                <li>并发登录控制 (可配置)</li>
            </ul>
        </div>
        <div class="tip-box info">
            <h5 style="margin-bottom: 12px;">数据安全</h5>
            <ul style="font-size: 13px;">
                <li>敏感数据加密存储</li>
                <li>传输使用 HTTPS</li>
                <li>日志脱敏处理</li>
                <li>数据库定期备份</li>
            </ul>
        </div>
        <div class="tip-box success">
            <h5 style="margin-bottom: 12px;">接口安全</h5>
            <ul style="font-size: 13px;">
                <li>所有接口需要认证</li>
                <li>实施请求限流</li>
                <li>输入参数验证</li>
                <li>输出数据过滤</li>
            </ul>
        </div>
        <div class="tip-box">
            <h5 style="margin-bottom: 12px;">运维安全</h5>
            <ul style="font-size: 13px;">
                <li>定期更新依赖</li>
                <li>安全漏洞扫描</li>
                <li>异常登录告警</li>
                <li>敏感操作审批</li>
            </ul>
        </div>
    </div>

    <h4>8.3 安全配置建议</h4>
    <table>
        <thead>
            <tr>
                <th>配置项</th>
                <th>推荐值</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Access Token 有效期</td>
                <td>15 分钟</td>
                <td>短期有效，减少泄露风险</td>
            </tr>
            <tr>
                <td>Refresh Token 有效期</td>
                <td>7 天</td>
                <td>支持长期会话</td>
            </tr>
            <tr>
                <td>密码最小长度</td>
                <td>8 位</td>
                <td>含大小写、数字、特殊字符</td>
            </tr>
            <tr>
                <td>登录失败锁定</td>
                <td>5 次 / 30 分钟</td>
                <td>防止暴力破解</td>
            </tr>
            <tr>
                <td>Session 超时</td>
                <td>30 分钟</td>
                <td>无操作自动登出</td>
            </tr>
            <tr>
                <td>bcrypt cost</td>
                <td>12</td>
                <td>密码哈希强度</td>
            </tr>
            <tr>
                <td>PBKDF2 迭代次数</td>
                <td>100,000</td>
                <td>密钥派生强度</td>
            </tr>
            <tr>
                <td>API 限流</td>
                <td>100 次/分钟</td>
                <td>防止滥用</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
</script>
</body>
</html>
