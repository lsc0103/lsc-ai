<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03 - æœ¬åœ°å¼€å‘æ–¹æ¡ˆ - Client Agent æ¶æ„</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="../assets/mermaid.min.js"></script>
</head>
<body class="section-page">
<div class="section-page">
    <div class="section-header">
        <h2>03 - æœ¬åœ°å¼€å‘æ–¹æ¡ˆ - Client Agent æ¶æ„</h2>
        <div class="meta">æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0 | æ›´æ–°æ—¥æœŸï¼š2026-01-19</div>
    </div>

    <h3>ä¸€ã€é—®é¢˜èƒŒæ™¯</h3>

    <h4>1.1 æ ¸å¿ƒæŒ‘æˆ˜</h4>
    <div class="arch-diagram">
        <div class="arch-title">é—®é¢˜æè¿°</div>
        <div class="grid-2" style="align-items: center;">
            <div class="arch-layer" style="border-color: #1890ff;">
                <span class="layer-title" style="color: #1890ff;">LSC-AI æœåŠ¡å™¨</span>
                <div style="padding: 20px; text-align: center;">
                    <div class="arch-box primary">
                        <div class="arch-box-title">LSC-AI Platform</div>
                        <div class="arch-box-desc">AI æœåŠ¡</div>
                    </div>
                </div>
            </div>
            <div class="arch-layer" style="border-color: #52c41a;">
                <span class="layer-title" style="color: #52c41a;">ç”¨æˆ·ç”µè„‘</span>
                <div style="padding: 20px; text-align: center;">
                    <div class="arch-box success">
                        <div class="arch-box-title">æœ¬åœ°ä»£ç  / æ–‡ä»¶</div>
                        <div class="arch-box-desc">ç”¨æˆ·å·¥ä½œç›®å½•</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="connector" style="font-size: 24px;">?</div>
        <div class="tip-box warning" style="margin-top: 16px;">
            <h5>é—®é¢˜ï¼š</h5>
            <ul>
                <li>æœåŠ¡å™¨æ— æ³•ç›´æ¥è®¿é—®ç”¨æˆ·ç”µè„‘æ–‡ä»¶ç³»ç»Ÿ</li>
                <li>ç”¨æˆ·ç”µè„‘é€šå¸¸æ²¡æœ‰å…¬ç½‘ IPï¼ŒæœåŠ¡å™¨æ— æ³•ä¸»åŠ¨è¿æ¥</li>
                <li>ç”¨æˆ·å¸Œæœ› AI èƒ½å¸®åŠ©åœ¨æœ¬åœ°è¿›è¡Œä»£ç å¼€å‘</li>
            </ul>
        </div>
    </div>

    <h4>1.2 ç”¨æˆ·åœºæ™¯</h4>
    <div class="grid-4">
        <div class="feature-card">
            <h5>æœ¬åœ°ä»£ç å¼€å‘</h5>
            <p>ç”¨æˆ·è®© AI å¸®å¿™åœ¨æœ¬åœ°å†™ä»£ç ã€ä¿®æ”¹æ–‡ä»¶</p>
        </div>
        <div class="feature-card">
            <h5>æœ¬åœ°é¡¹ç›®åˆ†æ</h5>
            <p>AI è¯»å–æœ¬åœ°é¡¹ç›®æ–‡ä»¶è¿›è¡Œåˆ†æ</p>
        </div>
        <div class="feature-card">
            <h5>æœ¬åœ°å‘½ä»¤æ‰§è¡Œ</h5>
            <p>AI åœ¨ç”¨æˆ·ç”µè„‘æ‰§è¡Œ npmã€git ç­‰å‘½ä»¤</p>
        </div>
        <div class="feature-card">
            <h5>æœ¬åœ°æ–‡ä»¶æ“ä½œ</h5>
            <p>åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æœ¬åœ°æ–‡ä»¶</p>
        </div>
    </div>

    <h3>äºŒã€è§£å†³æ–¹æ¡ˆï¼šClient Agent</h3>

    <h4>2.1 æ–¹æ¡ˆæ¦‚è¿°</h4>
    <p>åœ¨ç”¨æˆ·ç”µè„‘ä¸Šè¿è¡Œä¸€ä¸ªè½»é‡çº§çš„ <strong>Client Agent</strong>ï¼Œä¸»åŠ¨è¿æ¥åˆ° LSC-AI æœåŠ¡å™¨ï¼Œå»ºç«‹åŒå‘é€šä¿¡é€šé“ã€‚</p>

    <div class="arch-diagram">
        <div class="arch-title">Client Agent æ¶æ„</div>
        <div class="grid-2" style="gap: 24px;">
            <!-- ç”¨æˆ·ç”µè„‘ -->
            <div class="arch-layer user-layer">
                <span class="layer-title" style="color: #52c41a;">ç”¨æˆ·ç”µè„‘</span>
                <div style="padding: 20px;">
                    <div class="arch-box success" style="margin-bottom: 16px;">
                        <div class="arch-box-title">Client Agent</div>
                        <div class="arch-box-desc">æ–‡ä»¶è¯»å†™ | å‘½ä»¤æ‰§è¡Œ | çŠ¶æ€ä¸ŠæŠ¥</div>
                    </div>
                    <div class="connector" style="font-size: 16px;">|</div>
                    <div class="arch-box" style="margin-top: 8px;">
                        <div class="arch-box-title">æœ¬åœ°æ–‡ä»¶ / Shell</div>
                    </div>
                </div>
            </div>
            <!-- LSC-AI æœåŠ¡å™¨ -->
            <div class="arch-layer app-layer">
                <span class="layer-title" style="color: #1890ff;">LSC-AI æœåŠ¡å™¨</span>
                <div style="padding: 20px;">
                    <div class="arch-box primary" style="margin-bottom: 16px;">
                        <div class="arch-box-title">Agent Manager</div>
                        <div class="arch-box-desc">è¿æ¥ç®¡ç† | æŒ‡ä»¤ä¸‹å‘ | ç»“æœæ¥æ”¶</div>
                    </div>
                    <div class="connector" style="font-size: 16px;">|</div>
                    <div class="arch-box primary" style="margin-top: 8px;">
                        <div class="arch-box-title">LSC-AI Core (AI å†³ç­–)</div>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align: center; margin: 20px 0; font-size: 14px; color: var(--text-secondary);">
            <span style="background: #e6f7ff; padding: 8px 16px; border-radius: 20px; border: 1px solid #91d5ff;">
                WebSocket (ç”¨æˆ·ä¸»åŠ¨è¿æ¥ / æœåŠ¡å™¨ä¸‹å‘æŒ‡ä»¤)
            </span>
        </div>
        <div class="tip-box success">
            <h5>å…³é”®ç‚¹ï¼š</h5>
            <ul style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <li>ç”¨æˆ·ç”µè„‘ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨ï¼ˆæ— éœ€å…¬ç½‘ IPï¼‰</li>
                <li>WebSocket ä¿æŒé•¿è¿æ¥</li>
                <li>æœåŠ¡å™¨é€šè¿‡ WebSocket ä¸‹å‘æŒ‡ä»¤</li>
                <li>Agent åœ¨æœ¬åœ°æ‰§è¡Œå¹¶è¿”å›ç»“æœ</li>
            </ul>
        </div>
    </div>

    <h4>2.2 å·¥ä½œæµç¨‹æ—¶åºå›¾</h4>
    <div class="mermaid">
sequenceDiagram
    participant Browser as ç”¨æˆ·æµè§ˆå™¨
    participant Server as LSC-AI æœåŠ¡å™¨
    participant Agent as Client Agent
    participant Local as æœ¬åœ°æ–‡ä»¶

    Browser->>Server: 1. é€‰æ‹©å·¥ä½œè·¯å¾„
    Server-->>Browser: 2. æç¤ºå®‰è£…/å¯åŠ¨ Client Agent
    Agent->>Server: 3. WebSocket è¿æ¥
    Agent->>Server: 4. è®¤è¯ (Token)
    Server-->>Browser: 5. è¿æ¥æˆåŠŸ
    Browser->>Server: 6. å‘é€æ¶ˆæ¯: "å¸®æˆ‘åˆ›å»ºä¸€ä¸ª React é¡¹ç›®"
    Note over Server: 7. AI å†³ç­–: éœ€è¦æ‰§è¡Œ npx å‘½ä»¤
    Server->>Agent: 8. ä¸‹å‘æŒ‡ä»¤: {type: "bash", cmd: "npx..."}
    Agent->>Local: 9. æ‰§è¡Œå‘½ä»¤
    Local-->>Agent: 10. è¿”å›ç»“æœ
    Agent->>Server: 11. è¿”å›æ‰§è¡Œç»“æœ
    Server-->>Browser: 12. æµå¼å±•ç¤º AI å¤„ç†è¿‡ç¨‹
    </div>

    <h3>ä¸‰ã€Client Agent è®¾è®¡</h3>

    <h4>3.1 åŠŸèƒ½åˆ—è¡¨</h4>
    <table>
        <thead><tr><th>åŠŸèƒ½</th><th>æè¿°</th></tr></thead>
        <tbody>
            <tr><td>æ–‡ä»¶è¯»å–</td><td>è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰</td></tr>
            <tr><td>äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–</td><td>è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆOffice æ–‡æ¡£ã€å›¾ç‰‡ç­‰ï¼Œbase64 è¿”å›ï¼‰</td></tr>
            <tr><td>æ–‡ä»¶å†™å…¥</td><td>åˆ›å»ºæˆ–è¦†ç›–æœ¬åœ°æ–‡ä»¶ï¼ˆæ–‡æœ¬ï¼‰</td></tr>
            <tr><td>äºŒè¿›åˆ¶æ–‡ä»¶å†™å…¥</td><td>å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆOffice æ–‡æ¡£ã€å›¾ç‰‡ç­‰ï¼‰</td></tr>
            <tr><td>æ–‡ä»¶ç¼–è¾‘</td><td>å·®å¼‚åŒ–ç¼–è¾‘æ–‡ä»¶</td></tr>
            <tr><td>ç›®å½•åˆ—è¡¨</td><td>åˆ—å‡ºç›®å½•å†…å®¹</td></tr>
            <tr><td>æ–‡ä»¶æœç´¢</td><td>Glob æ¨¡å¼æœç´¢æ–‡ä»¶</td></tr>
            <tr><td>å†…å®¹æœç´¢</td><td>Grep æœç´¢æ–‡ä»¶å†…å®¹</td></tr>
            <tr><td>å‘½ä»¤æ‰§è¡Œ</td><td>æ‰§è¡Œ Shell å‘½ä»¤</td></tr>
            <tr><td>Git æ“ä½œ</td><td>Git ç›¸å…³å‘½ä»¤</td></tr>
            <tr><td>è¿›ç¨‹ç®¡ç†</td><td>å¯åŠ¨/åœæ­¢æœ¬åœ°è¿›ç¨‹</td></tr>
            <tr><td>æ–‡ä»¶æ‰“å¼€</td><td>ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åºæ‰“å¼€æ–‡ä»¶</td></tr>
        </tbody>
    </table>

    <h4>3.2 é€šä¿¡åè®®</h4>
    <pre><code>// æŒ‡ä»¤ç±»å‹å®šä¹‰
interface AgentCommand {
  id: string;           // æŒ‡ä»¤å”¯ä¸€ID
  type: CommandType;    // æŒ‡ä»¤ç±»å‹
  payload: any;         // æŒ‡ä»¤å‚æ•°
  timeout?: number;     // è¶…æ—¶æ—¶é—´(ms)
}

type CommandType =
  | 'file:read'         // è¯»å–æ–‡ä»¶ï¼ˆæ–‡æœ¬ï¼‰
  | 'file:read:binary'  // è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆè¿”å›base64ï¼‰
  | 'file:write'        // å†™å…¥æ–‡ä»¶ï¼ˆæ–‡æœ¬ï¼‰
  | 'file:write:binary' // å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆbase64ç¼–ç ï¼‰
  | 'file:edit'         // ç¼–è¾‘æ–‡ä»¶
  | 'file:delete'       // åˆ é™¤æ–‡ä»¶
  | 'file:open'         // ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åºæ‰“å¼€æ–‡ä»¶
  | 'dir:list'          // åˆ—å‡ºç›®å½•
  | 'dir:create'        // åˆ›å»ºç›®å½•
  | 'search:glob'       // Glob æœç´¢
  | 'search:grep'       // Grep æœç´¢
  | 'bash:execute'      // æ‰§è¡Œå‘½ä»¤
  | 'bash:background'   // åå°æ‰§è¡Œ
  | 'bash:kill'         // ç»ˆæ­¢è¿›ç¨‹
  | 'system:info'       // ç³»ç»Ÿä¿¡æ¯
  | 'heartbeat';        // å¿ƒè·³

// å“åº”ç±»å‹å®šä¹‰
interface AgentResponse {
  id: string;           // å¯¹åº”æŒ‡ä»¤ID
  success: boolean;     // æ˜¯å¦æˆåŠŸ
  data?: any;           // è¿”å›æ•°æ®
  error?: string;       // é”™è¯¯ä¿¡æ¯
}</code></pre>

    <h4>3.3 å®‰å…¨æœºåˆ¶</h4>
    <div class="grid-2">
        <div class="tip-box info">
            <h5>1. è®¤è¯æœºåˆ¶</h5>
            <ul>
                <li>Client Agent å¯åŠ¨æ—¶ç”Ÿæˆé…å¯¹ Token</li>
                <li>ç”¨æˆ·åœ¨ Web ç«¯è¾“å…¥ Token å®Œæˆé…å¯¹</li>
                <li>Token ç»‘å®šåˆ°ç”¨æˆ·è´¦å·</li>
            </ul>
        </div>
        <div class="tip-box info">
            <h5>2. å·¥ä½œç›®å½•é™åˆ¶</h5>
            <ul>
                <li>åªèƒ½åœ¨ç”¨æˆ·æŒ‡å®šçš„å·¥ä½œç›®å½•å†…æ“ä½œ</li>
                <li>ç¦æ­¢è®¿é—®ç³»ç»Ÿæ•æ„Ÿç›®å½•</li>
                <li>è·¯å¾„éå†æ”»å‡»é˜²æŠ¤</li>
            </ul>
        </div>
        <div class="tip-box warning">
            <h5>3. å‘½ä»¤ç™½åå•</h5>
            <ul>
                <li>åªå…è®¸æ‰§è¡Œé¢„å®šä¹‰çš„å®‰å…¨å‘½ä»¤</li>
                <li>å±é™©å‘½ä»¤éœ€è¦ç”¨æˆ·äºŒæ¬¡ç¡®è®¤</li>
                <li>ç¦æ­¢æ‰§è¡Œ rm -rf / ç­‰å±é™©å‘½ä»¤</li>
            </ul>
        </div>
        <div class="tip-box warning">
            <h5>4. ç”¨æˆ·ç¡®è®¤</h5>
            <ul>
                <li>æ•æ„Ÿæ“ä½œéœ€è¦ç”¨æˆ·åœ¨ Web ç«¯ç¡®è®¤</li>
                <li>æ–‡ä»¶å†™å…¥/åˆ é™¤éœ€è¦ç¡®è®¤</li>
                <li>å‘½ä»¤æ‰§è¡Œéœ€è¦ç¡®è®¤ï¼ˆå¯é…ç½®è‡ªåŠ¨ç¡®è®¤ï¼‰</li>
            </ul>
        </div>
    </div>

    <h3>å››ã€å®ç°æ–¹æ¡ˆ</h3>

    <h4>4.1 æŠ€æœ¯é€‰å‹</h4>
    <table>
        <thead><tr><th>ç»„ä»¶</th><th>æŠ€æœ¯é€‰å‹</th><th>ç†ç”±</th></tr></thead>
        <tbody>
            <tr><td>è¿è¡Œæ—¶</td><td><strong>Node.js</strong></td><td>ä¸ LSC-AI æŠ€æœ¯æ ˆä¸€è‡´</td></tr>
            <tr><td>é€šä¿¡</td><td><strong>Socket.io-client</strong></td><td>æˆç†Ÿç¨³å®šï¼Œè‡ªåŠ¨é‡è¿</td></tr>
            <tr><td>æ‰“åŒ…</td><td><strong>pkg æˆ– electron</strong></td><td>æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</td></tr>
            <tr><td>å®‰è£…</td><td><strong>npm å…¨å±€å®‰è£…</strong></td><td>ç®€å•ä¾¿æ·</td></tr>
        </tbody>
    </table>

    <h4>4.2 ä»£ç ç»“æ„</h4>
    <pre><code>lsc-ai-client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # å…¥å£
â”‚   â”œâ”€â”€ connection/
â”‚   â”‚   â”œâ”€â”€ socket.ts         # WebSocket è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ auth.ts           # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ file.ts           # æ–‡ä»¶æ“ä½œå¤„ç†
â”‚   â”‚   â”œâ”€â”€ bash.ts           # å‘½ä»¤æ‰§è¡Œå¤„ç†
â”‚   â”‚   â”œâ”€â”€ search.ts         # æœç´¢å¤„ç†
â”‚   â”‚   â””â”€â”€ system.ts         # ç³»ç»Ÿä¿¡æ¯
â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”œâ”€â”€ validator.ts      # è·¯å¾„/å‘½ä»¤éªŒè¯
â”‚   â”‚   â””â”€â”€ sandbox.ts        # æ²™ç®±é™åˆ¶
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.ts         # æ—¥å¿—
â”‚       â””â”€â”€ config.ts         # é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md</code></pre>

    <h4>4.3 æ ¸å¿ƒä»£ç ç¤ºä¾‹</h4>
    <pre><code>// src/index.ts
import { io, Socket } from 'socket.io-client';
import os from 'os';
import { handleCommand } from './handlers';
import { validatePath, validateCommand } from './security/validator';
import { loadConfig } from './utils/config';

class ClientAgent {
  private socket: Socket;
  private config: AgentConfig;

  constructor(serverUrl: string, token: string) {
    this.config = loadConfig();  // åŠ è½½å…è®¸çš„ç›®å½•åˆ—è¡¨ç­‰é…ç½®

    this.socket = io(serverUrl, {
      auth: { token },
      reconnection: true,
      reconnectionAttempts: Infinity,
    });

    this.setupEventHandlers();
  }

  private setupEventHandlers() {
    this.socket.on('connect', () => {
      console.log('Connected to LSC-AI server');
      // æ³¨å†Œæ—¶ä¸ŠæŠ¥å…è®¸è®¿é—®çš„ç›®å½•åˆ—è¡¨ï¼Œä¾›æµè§ˆå™¨ç«¯æ˜¾ç¤º
      this.socket.emit('agent:register', {
        allowedPaths: this.config.allowedPaths,
        platform: process.platform,
        hostname: os.hostname(),
        version: '1.0.0',
      });
    });

    this.socket.on('disconnect', () => {
      console.log('Disconnected from server');
    });

    // æ¥æ”¶æœåŠ¡å™¨æŒ‡ä»¤ï¼ˆæŒ‡ä»¤ä¸­åŒ…å«å®Œæ•´è·¯å¾„ï¼‰
    this.socket.on('command', async (cmd: AgentCommand) => {
      console.log(`Received command: ${cmd.type}`);

      try {
        // å®‰å…¨éªŒè¯ï¼šæ£€æŸ¥è·¯å¾„æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
        if (cmd.type.startsWith('file:') || cmd.type.startsWith('dir:')) {
          validatePath(cmd.payload.path, this.config.allowedPaths);
        }
        if (cmd.type === 'bash:execute') {
          validateCommand(cmd.payload.command, this.config.commandBlacklist);
        }

        // æ‰§è¡ŒæŒ‡ä»¤
        const result = await handleCommand(cmd);

        // è¿”å›ç»“æœ
        this.socket.emit('command:result', {
          id: cmd.id,
          success: true,
          data: result,
        });
      } catch (error) {
        this.socket.emit('command:result', {
          id: cmd.id,
          success: false,
          error: error.message,
        });
      }
    });

    // å¿ƒè·³
    setInterval(() => {
      this.socket.emit('heartbeat', { timestamp: Date.now() });
    }, 30000);
  }
}

// é…ç½®æ¥å£
interface AgentConfig {
  allowedPaths: string[];      // å…è®¸è®¿é—®çš„ç›®å½•åˆ—è¡¨
  commandBlacklist: string[];  // ç¦æ­¢çš„å‘½ä»¤åˆ—è¡¨
}

// é»˜è®¤é…ç½®ï¼šå…è®¸ç”¨æˆ·ä¸»ç›®å½•
function loadConfig(): AgentConfig {
  return {
    allowedPaths: [os.homedir()],  // é»˜è®¤å…è®¸ç”¨æˆ·ä¸»ç›®å½•
    commandBlacklist: ['rm -rf /', 'format', 'mkfs'],
  };
}

// å¯åŠ¨ Agentï¼ˆä¸ç»‘å®šå›ºå®šå·¥ä½œç›®å½•ï¼‰
const agent = new ClientAgent(
  process.env.LSC_AI_SERVER || 'https://lsc-ai.company.com',
  process.env.LSC_AI_TOKEN
);</code></pre>

    <h3>äº”ã€ç”¨æˆ·ä½¿ç”¨æµç¨‹</h3>

    <h4>5.1 è®¾è®¡åŸåˆ™</h4>
    <div class="tip-box info">
        <h5>æ ¸å¿ƒç†å¿µï¼šä¸€æ¬¡å®‰è£…ï¼ŒæŒç»­è¿è¡Œ</h5>
        <ul>
            <li>Client Agent ä½œä¸º<strong>å¸¸é©»æœåŠ¡</strong>è¿è¡Œï¼Œä¸ç»‘å®šå›ºå®šå·¥ä½œè·¯å¾„</li>
            <li>ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­é€‰æ‹©å·¥ä½œè·¯å¾„ï¼ŒæœåŠ¡å™¨åŠ¨æ€ä¸‹å‘åˆ° Agent</li>
            <li>åˆ‡æ¢é¡¹ç›®æ— éœ€é‡å¯ Agentï¼Œåœ¨æµè§ˆå™¨ä¸­åˆ‡æ¢å³å¯</li>
        </ul>
    </div>

    <h4>5.2 é¦–æ¬¡å®‰è£…</h4>
    <div class="arch-diagram">
        <div class="arch-title">é¦–æ¬¡å®‰è£…æµç¨‹ï¼ˆä»…ä¸€æ¬¡ï¼‰</div>
        <ol style="padding-left: 24px; line-height: 2;">
            <li>ç”¨æˆ·åœ¨èŠå¤©ç•Œé¢ç‚¹å‡»è¾“å…¥æ¡†å·¦ä¾§ã€+ã€‘â†’ã€é€‰æ‹©å·¥ä½œè·¯å¾„ã€‘</li>
            <li>ç”¨æˆ·é€‰æ‹©ã€æœ¬åœ°ç”µè„‘ã€‘ï¼Œç³»ç»Ÿæ£€æµ‹åˆ°æ²¡æœ‰ Client Agent è¿æ¥</li>
            <li>å¼¹å‡ºå®‰è£…å¼•å¯¼å¯¹è¯æ¡†ï¼ˆè§ä¸‹æ–¹ï¼‰</li>
        </ol>
    </div>

    <h4>5.3 å®‰è£…å¼•å¯¼å¯¹è¯æ¡†è®¾è®¡</h4>
    <div class="arch-diagram" style="background: #fff; border: 2px solid var(--primary-color);">
        <div class="arch-title" style="font-size: 18px;">å®‰è£… LSC-AI Client Agent</div>

        <div class="tip-box info" style="margin: 16px 0; text-align: left;">
            <h5 style="margin-bottom: 8px;">ä¸ºä»€ä¹ˆéœ€è¦å®‰è£…ï¼Ÿ</h5>
            <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼ŒAI æ— æ³•ç›´æ¥è®¿é—®æ‚¨ç”µè„‘ä¸Šçš„æ–‡ä»¶ã€‚<br/>
            å®‰è£… Client Agent åï¼ŒAI å°±èƒ½åœ¨æ‚¨çš„æœ¬åœ°ç”µè„‘ä¸Šè¿›è¡Œæ–‡ä»¶æ“ä½œã€‚</p>
        </div>

        <div class="grid-2" style="gap: 16px; margin: 16px 0; text-align: left;">
            <div class="tip-box success">
                <h5>å®‰è£…åå¯ä»¥åšä»€ä¹ˆï¼Ÿ</h5>
                <ul style="margin-top: 8px; font-size: 13px;">
                    <li>æœ¬åœ°ä»£ç å¼€å‘ï¼ˆè¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ï¼‰</li>
                    <li>æœ¬åœ°é¡¹ç›®åˆ†æï¼ˆè¯»å–ä»£ç ã€æœç´¢ï¼‰</li>
                    <li>æœ¬åœ° Git æ“ä½œ</li>
                    <li>æœ¬åœ° Office æ–‡æ¡£ç”Ÿæˆå¹¶ä¿å­˜</li>
                    <li>å¯åŠ¨/ç®¡ç†æœ¬åœ°å¼€å‘æœåŠ¡å™¨</li>
                </ul>
            </div>
            <div class="tip-box warning">
                <h5>ä¸å®‰è£…ä¹Ÿèƒ½ä½¿ç”¨çš„åŠŸèƒ½</h5>
                <ul style="margin-top: 8px; font-size: 13px;">
                    <li>RPA æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰</li>
                    <li>å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰</li>
                    <li>è·¨æœåŠ¡å™¨ç›‘ç®¡ï¼ˆSentinel Agentï¼‰</li>
                    <li>æŸ¥è¯¢ä¸šåŠ¡ç³»ç»Ÿæ•°æ®ï¼ˆAPI è°ƒç”¨ï¼‰</li>
                </ul>
            </div>
        </div>

        <div style="border-top: 1px solid var(--border-color); padding-top: 16px; margin-top: 16px;">
            <p style="margin-bottom: 12px;"><strong>æ£€æµ‹åˆ°æ‚¨çš„æ“ä½œç³»ç»Ÿï¼šWindows 11</strong></p>

            <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin: 16px 0;">
                <div class="arch-box primary" style="cursor: pointer; min-width: 200px;">
                    <div class="arch-box-title">ğŸ“¥ ä¸‹è½½ Windows ç‰ˆæœ¬</div>
                    <div class="arch-box-desc">lsc-ai-client-1.0.0-win.exe</div>
                </div>
            </div>

            <p style="font-size: 12px; color: var(--text-secondary);">
                å…¶ä»–ç‰ˆæœ¬ï¼š<a href="#">macOS (.dmg)</a> | <a href="#">Linux (.deb)</a> | <a href="#">Linux (.rpm)</a> | <a href="#">npm å®‰è£…</a>
            </p>
        </div>

        <div style="border-top: 1px solid var(--border-color); padding-top: 16px; margin-top: 16px; text-align: left;">
            <h5>å®‰è£…æ­¥éª¤ï¼š</h5>
            <ol style="font-size: 13px; padding-left: 20px; margin-top: 8px;">
                <li>ä¸‹è½½ä¸Šæ–¹å®‰è£…åŒ…</li>
                <li>åŒå‡»è¿è¡Œå®‰è£…ç¨‹åºï¼ŒæŒ‰æç¤ºå®Œæˆå®‰è£…</li>
                <li>å®‰è£…å®Œæˆåä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œå¹¶æ˜¾ç¤ºé…å¯¹ç </li>
                <li>åœ¨ä¸‹æ–¹è¾“å…¥é…å¯¹ç å®Œæˆç»‘å®š</li>
            </ol>
        </div>

        <div style="border-top: 1px solid var(--border-color); padding-top: 16px; margin-top: 16px;">
            <p><strong>è¾“å…¥é…å¯¹ç ï¼š</strong></p>
            <div style="display: flex; gap: 12px; justify-content: center; align-items: center; margin-top: 12px;">
                <input type="text" placeholder="è¯·è¾“å…¥ 6 ä½é…å¯¹ç " style="padding: 8px 16px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 16px; width: 200px; text-align: center; letter-spacing: 4px;">
                <button style="padding: 8px 24px; background: var(--primary-color); color: #fff; border: none; border-radius: 4px; cursor: pointer;">ç¡®è®¤ç»‘å®š</button>
            </div>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">é…å¯¹ç æ˜¾ç¤ºåœ¨ Client Agent å¯åŠ¨åçš„çª—å£ä¸­</p>
        </div>
    </div>

    <div style="margin-top: 16px;">
        <ol start="4" style="padding-left: 24px; line-height: 2;">
            <li>ç”¨æˆ·ä¸‹è½½å®‰è£…åŒ…ï¼ŒåŒå‡»å®‰è£…ï¼ˆè‡ªåŠ¨è®¾ç½®å¼€æœºè‡ªå¯ï¼‰</li>
            <li>å®‰è£…å®Œæˆå Agent è‡ªåŠ¨å¯åŠ¨ï¼Œæ˜¾ç¤º 6 ä½é…å¯¹ç </li>
            <li>ç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥é…å¯¹ç ï¼Œå®Œæˆç»‘å®š</li>
            <li>ç»‘å®šæˆåŠŸï¼Œå¼¹å‡ºæœ¬åœ°æ–‡ä»¶å¤¹é€‰æ‹©å™¨ï¼Œé€‰æ‹©å·¥ä½œè·¯å¾„åå¼€å§‹ä½¿ç”¨</li>
        </ol>
    </div>

    <h4>5.4 æ—¥å¸¸ä½¿ç”¨</h4>
    <div class="arch-diagram">
        <div class="arch-title">æ—¥å¸¸ä½¿ç”¨æµç¨‹</div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap; margin: 20px 0;">
            <div class="arch-box success" style="min-width: 140px;">
                <div class="arch-box-title">Client Agent</div>
                <div class="arch-box-desc">åå°æŒç»­è¿è¡Œ<br/>ï¼ˆå¼€æœºè‡ªå¯ï¼‰</div>
            </div>
            <div class="connector">â†è¿æ¥â†’</div>
            <div class="arch-box primary" style="min-width: 140px;">
                <div class="arch-box-title">LSC-AI æœåŠ¡å™¨</div>
                <div class="arch-box-desc">WebSocket é•¿è¿æ¥</div>
            </div>
            <div class="connector">â†â†’</div>
            <div class="arch-box" style="min-width: 140px;">
                <div class="arch-box-title">ç”¨æˆ·æµè§ˆå™¨</div>
                <div class="arch-box-desc">é€‰æ‹©å·¥ä½œè·¯å¾„<br/>å‘é€ä»»åŠ¡æŒ‡ä»¤</div>
            </div>
        </div>
        <div class="tip-box success">
            <h5>ç”¨æˆ·åªéœ€åœ¨æµè§ˆå™¨ä¸­æ“ä½œï¼š</h5>
            <ol>
                <li>ç‚¹å‡»è¾“å…¥æ¡†å·¦ä¾§ã€+ã€‘â†’ã€é€‰æ‹©å·¥ä½œè·¯å¾„ã€‘â†’ã€æœ¬åœ°ç”µè„‘ã€‘</li>
                <li>é€‰æ‹©æœ¬åœ°æ–‡ä»¶å¤¹ï¼ˆå¦‚ <code>D:\projects\my-app</code>ï¼‰</li>
                <li>å¼€å§‹å¯¹è¯ï¼š"å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®çš„ä»£ç ç»“æ„"</li>
                <li>åˆ‡æ¢é¡¹ç›®ï¼Ÿé‡æ–°é€‰æ‹©å·¥ä½œè·¯å¾„å³å¯ï¼Œæ— éœ€é‡å¯ Agent</li>
            </ol>
        </div>
    </div>

    <h4>5.5 æŒ‡ä»¤ä¸­çš„è·¯å¾„å¤„ç†</h4>
    <pre><code>// æœåŠ¡å™¨ä¸‹å‘çš„æŒ‡ä»¤åŒ…å«å®Œæ•´è·¯å¾„
{
  id: "cmd_456",
  type: "file:read",
  payload: {
    path: "D:\\projects\\my-app\\src\\index.ts"  // å®Œæ•´ç»å¯¹è·¯å¾„
  }
}

// Client Agent éªŒè¯è·¯å¾„åˆæ³•æ€§
function validatePath(targetPath: string, allowedPaths: string[]) {
  const normalized = path.resolve(targetPath);

  // æ£€æŸ¥æ˜¯å¦åœ¨ç”¨æˆ·å…è®¸çš„ç›®å½•èŒƒå›´å†…
  const isAllowed = allowedPaths.some(allowed =>
    normalized.startsWith(path.resolve(allowed))
  );

  if (!isAllowed) {
    throw new Error(`è·¯å¾„ä¸åœ¨å…è®¸èŒƒå›´å†…: ${targetPath}`);
  }

  // é˜²æ­¢è·¯å¾„éå†æ”»å‡»
  if (normalized.includes('..')) {
    throw new Error('ç¦æ­¢è·¯å¾„éå†');
  }
}</code></pre>

    <h4>5.6 å®‰å…¨ï¼šå…è®¸è®¿é—®çš„ç›®å½•</h4>
    <div class="grid-2">
        <div class="tip-box info">
            <h5>é»˜è®¤å…è®¸</h5>
            <ul>
                <li>ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹</li>
                <li>å¦‚ <code>C:\Users\å¼ ä¸‰\*</code></li>
                <li>å¦‚ <code>/home/zhangsan/*</code></li>
            </ul>
        </div>
        <div class="tip-box warning">
            <h5>é»˜è®¤ç¦æ­¢</h5>
            <ul>
                <li>ç³»ç»Ÿç›®å½• (<code>C:\Windows</code>, <code>/etc</code>)</li>
                <li>å…¶ä»–ç”¨æˆ·ç›®å½•</li>
                <li>æ•æ„Ÿé…ç½®æ–‡ä»¶</li>
            </ul>
        </div>
    </div>
    <p>ç”¨æˆ·å¯åœ¨ Client Agent é…ç½®ä¸­è‡ªå®šä¹‰å…è®¸/ç¦æ­¢çš„ç›®å½•åˆ—è¡¨ã€‚</p>

    <h4>5.7 ç•Œé¢çŠ¶æ€æŒ‡ç¤º</h4>
    <div class="arch-diagram">
        <div class="arch-title">Web ç•Œé¢çŠ¶æ€æŒ‡ç¤º</div>
        <div class="grid-2" style="gap: 24px; margin-top: 16px;">
            <div class="feature-card" style="border: 2px solid #52c41a;">
                <h5>å·²è¿æ¥çŠ¶æ€</h5>
                <p style="margin-top: 12px;">æ¨¡å¼: <strong>æœ¬åœ°æ¨¡å¼</strong></p>
                <p>å·¥ä½œè·¯å¾„: <code>D:\projects\my-app</code> <span style="color: var(--primary-color); cursor: pointer;">[åˆ‡æ¢]</span></p>
                <p>çŠ¶æ€: <span class="status-tag online">Agent å·²è¿æ¥</span></p>
            </div>
            <div class="feature-card" style="border: 2px solid #ff4d4f;">
                <h5>æœªè¿æ¥çŠ¶æ€</h5>
                <p style="margin-top: 12px;">æ¨¡å¼: <strong>æœ¬åœ°æ¨¡å¼</strong></p>
                <p>å·¥ä½œè·¯å¾„: <code>D:\projects\my-app</code></p>
                <p>çŠ¶æ€: <span class="status-tag offline">Agent æœªè¿æ¥</span> <span style="color: var(--primary-color); cursor: pointer;">[å®‰è£…æŒ‡å¼•]</span></p>
            </div>
        </div>
    </div>

    <h3>å…­ã€é€šä¿¡æ¶æ„</h3>

    <h4>6.1 æ•´ä½“æ¶æ„</h4>
    <div class="tip-box warning" style="margin-bottom: 16px;">
        <h5>æ ¸å¿ƒåŸåˆ™</h5>
        <ul>
            <li>æµè§ˆå™¨å’Œ Client Agent ä¹‹é—´<strong>æ²¡æœ‰ç›´æ¥è¿æ¥</strong></li>
            <li>æ‰€æœ‰é€šä¿¡éƒ½é€šè¿‡ LSC-AI æœåŠ¡å™¨<strong>ä¸­è½¬</strong></li>
            <li>Client Agent <strong>ä¸»åŠ¨è¿æ¥</strong>æœåŠ¡å™¨ï¼ˆç”¨æˆ·ç”µè„‘é€šå¸¸æ²¡æœ‰å…¬ç½‘ IPï¼‰</li>
        </ul>
    </div>

    <div class="arch-diagram">
        <div class="arch-title">é€šä¿¡æ¶æ„å›¾</div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 20px 0;">
            <div class="arch-box" style="min-width: 120px;">
                <div class="arch-box-title">ç”¨æˆ·æµè§ˆå™¨</div>
                <div class="arch-box-desc">å·²ç™»å½•ç”¨æˆ·</div>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 12px; color: var(--text-secondary);">WebSocket</span>
                <span>â†â€•â€•â€•â†’</span>
            </div>
            <div class="arch-box primary" style="min-width: 140px;">
                <div class="arch-box-title">LSC-AI æœåŠ¡å™¨</div>
                <div class="arch-box-desc">ä¸­è½¬ / åè°ƒ / AIå†³ç­–</div>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 12px; color: var(--text-secondary);">WebSocket</span>
                <span>â†â€•â€•â€•â†’</span>
            </div>
            <div class="arch-box success" style="min-width: 120px;">
                <div class="arch-box-title">Client Agent</div>
                <div class="arch-box-desc">ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨</div>
            </div>
        </div>
    </div>

    <h4>6.2 é…å¯¹æœºåˆ¶</h4>
    <p>é…å¯¹ç ç”¨äºå°† Client Agent ä¸ç”¨æˆ·è´¦å·å®‰å…¨ç»‘å®šã€‚å› ä¸º Agent è¿è¡Œåœ¨ç”¨æˆ·æœ¬åœ°ç”µè„‘ï¼Œä¸çŸ¥é“ç”¨æˆ·èº«ä»½ï¼Œéœ€è¦é€šè¿‡é…å¯¹ç å®Œæˆå…³è”ã€‚</p>

    <div class="mermaid">
sequenceDiagram
    participant Agent as Client Agent<br/>(ç”¨æˆ·ç”µè„‘)
    participant Server as LSC-AI æœåŠ¡å™¨
    participant Browser as ç”¨æˆ·æµè§ˆå™¨<br/>(å·²ç™»å½•ï¼šå¼ ä¸‰)

    Agent->>Server: 1. é¦–æ¬¡è¿æ¥ï¼Œè¯·æ±‚é…å¯¹ç 
    Server->>Server: 2. ç”Ÿæˆ 6 ä½é…å¯¹ç  847291
    Server-->>Agent: 3. è¿”å›é…å¯¹ç 
    Note over Agent: æ˜¾ç¤ºï¼šé…å¯¹ç  847291

    Browser->>Server: 4. ç”¨æˆ·è¾“å…¥é…å¯¹ç  847291
    Server->>Server: 5. åŒ¹é…ï¼š847291 â†’ Agent<br/>ç»‘å®šåˆ°ç”¨æˆ·"å¼ ä¸‰"
    Server->>Agent: 6. ä¸‹å‘æŒä¹… Token
    Server-->>Browser: 7. é…å¯¹æˆåŠŸ

    Note over Agent,Browser: âœ… é…å¯¹å®Œæˆï¼Œåç»­ Agent ä½¿ç”¨ Token è‡ªåŠ¨è®¤è¯
    </div>

    <h4>6.3 é…å¯¹åçš„äº¤äº’æµç¨‹</h4>
    <div class="mermaid">
sequenceDiagram
    participant Browser as ç”¨æˆ·æµè§ˆå™¨
    participant Server as LSC-AI æœåŠ¡å™¨
    participant Core as LSC-AI Core
    participant Agent as Client Agent

    Browser->>Server: 1. "å¸®æˆ‘è¯»å– src/index.ts"
    Server->>Core: 2. AI å†³ç­–
    Core-->>Server: 3. éœ€è¦è°ƒç”¨ file:read
    Server->>Server: 4. æŸ¥æ‰¾ç”¨æˆ·çš„ Agent è¿æ¥
    Server->>Agent: 5. ä¸‹å‘æŒ‡ä»¤ file:read
    Agent->>Agent: 6. è¯»å–æœ¬åœ°æ–‡ä»¶
    Agent-->>Server: 7. è¿”å›æ–‡ä»¶å†…å®¹
    Server-->>Browser: 8. å±•ç¤ºç»“æœ
    </div>

    <h4>6.4 æœåŠ¡å™¨ç«¯ Agent ç®¡ç†</h4>
    <pre><code>// æœåŠ¡å™¨ç«¯ç»´æŠ¤çš„ Agent è¿æ¥æ˜ å°„
class AgentManager {
  // å­˜å‚¨ï¼šç”¨æˆ·ID â†’ Agent Socket è¿æ¥
  private agentConnections = new Map&lt;string, Socket&gt;();

  // Agent è¿æ¥æ—¶æ³¨å†Œ
  registerAgent(userId: string, socket: Socket) {
    this.agentConnections.set(userId, socket);
    console.log(`Agent registered for user: ${userId}`);
  }

  // å‘ç”¨æˆ·çš„ Agent å‘é€æŒ‡ä»¤
  async sendCommand(userId: string, command: AgentCommand): Promise&lt;any&gt; {
    const socket = this.agentConnections.get(userId);

    if (!socket) {
      throw new Error('ç”¨æˆ·çš„ Client Agent æœªè¿æ¥');
    }

    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error('Agent å“åº”è¶…æ—¶'));
      }, command.timeout || 30000);

      // å‘é€æŒ‡ä»¤
      socket.emit('command', command);

      // ç›‘å¬ç»“æœ
      socket.once(`command:result:${command.id}`, (result) => {
        clearTimeout(timeout);
        if (result.success) {
          resolve(result.data);
        } else {
          reject(new Error(result.error));
        }
      });
    });
  }

  // æ£€æŸ¥ç”¨æˆ·çš„ Agent æ˜¯å¦åœ¨çº¿
  isAgentOnline(userId: string): boolean {
    return this.agentConnections.has(userId);
  }
}</code></pre>

    <h4>6.5 å”¤èµ·æœºåˆ¶</h4>
    <table>
        <thead><tr><th>Agent çŠ¶æ€</th><th>å¤„ç†æ–¹å¼</th></tr></thead>
        <tbody>
            <tr>
                <td><strong>å·²è¿è¡Œä¸”å·²è¿æ¥</strong></td>
                <td>ç›´æ¥é€šè¿‡å·²æœ‰ WebSocket è¿æ¥ä¸‹å‘æŒ‡ä»¤</td>
            </tr>
            <tr>
                <td><strong>å·²å®‰è£…ä½†æœªè¿è¡Œ</strong></td>
                <td>
                    1. å°è¯•é€šè¿‡ <code>lsc-ai://start</code> åè®®å”¤èµ·<br/>
                    2. ç­‰å¾… Agent è¿æ¥æœåŠ¡å™¨<br/>
                    3. è¶…æ—¶åˆ™æç¤ºç”¨æˆ·æ‰‹åŠ¨å¯åŠ¨
                </td>
            </tr>
            <tr>
                <td><strong>æœªå®‰è£…</strong></td>
                <td>æ˜¾ç¤ºå®‰è£…å¼•å¯¼å¯¹è¯æ¡†</td>
            </tr>
        </tbody>
    </table>

    <pre><code>// æµè§ˆå™¨ç«¯å°è¯•å”¤èµ· Agent
async function tryWakeUpAgent(): Promise&lt;boolean&gt; {
  // 1. å°è¯•é€šè¿‡è‡ªå®šä¹‰åè®®å”¤èµ·
  window.location.href = 'lsc-ai://start';

  // 2. ç­‰å¾… Agent è¿æ¥ï¼ˆè½®è¯¢æ£€æŸ¥ï¼‰
  for (let i = 0; i < 10; i++) {
    await sleep(1000);
    const isOnline = await checkAgentStatus();
    if (isOnline) return true;
  }

  // 3. å”¤èµ·å¤±è´¥
  return false;
}</code></pre>

    <h3>ä¸ƒã€å†…æ ¸é›†æˆ</h3>

    <h4>7.1 FileSystemRouter</h4>
    <p>éœ€è¦åœ¨ LSC-AI å†…æ ¸ä¸­æ–°å¢ä¸€ä¸ª <code>RemoteFileSystem</code> å·¥å…·é€‚é…å™¨ï¼Œå½“å·¥ä½œè·¯å¾„æ˜¯è¿œç¨‹ï¼ˆç”¨æˆ·æœ¬åœ°ï¼‰æ—¶ï¼Œå°†æ–‡ä»¶æ“ä½œè·¯ç”±åˆ° Client Agentã€‚</p>
    <pre><code>// å†…æ ¸ä¸­çš„å·¥å…·è·¯ç”±é€»è¾‘
class FileSystemRouter {
  async read(path: string): Promise&lt;string&gt; {
    if (this.isRemotePath(path)) {
      // é€šè¿‡ Client Agent è¯»å–
      return this.clientAgent.execute({
        type: 'file:read',
        payload: { path }
      });
    } else {
      // æœ¬åœ°è¯»å–ï¼ˆæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼‰
      return fs.readFile(path, 'utf-8');
    }
  }

  async write(path: string, content: string): Promise&lt;void&gt; {
    if (this.isRemotePath(path)) {
      // é€šè¿‡ Client Agent å†™å…¥
      return this.clientAgent.execute({
        type: 'file:write',
        payload: { path, content }
      });
    } else {
      // æœ¬åœ°å†™å…¥
      return fs.writeFile(path, content);
    }
  }
}</code></pre>

    <h4>7.2 SessionContext æ¥å£</h4>
    <pre><code>// ä¼šè¯ä¸­è®°å½•å·¥ä½œæ¨¡å¼
interface SessionContext {
  workMode: 'server' | 'client';  // æœåŠ¡å™¨æœ¬åœ° æˆ– ç”¨æˆ·æœ¬åœ°
  workDir: string;                 // å·¥ä½œç›®å½•
  clientAgentId?: string;          // Client Agent ID
}</code></pre>

    <h3>å…«ã€ä¸å…¶ä»–åŠŸèƒ½çš„å…³ç³»</h3>

    <div class="arch-diagram">
        <div class="arch-title">Client Agent èƒ½åŠ›èŒƒå›´</div>
        <div class="grid-2" style="gap: 24px;">
            <div class="tip-box success">
                <h5>æ”¯æŒçš„åœºæ™¯</h5>
                <ul>
                    <li>æœ¬åœ°ä»£ç å¼€å‘ï¼ˆè¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ï¼‰</li>
                    <li>æœ¬åœ°é¡¹ç›®åˆ†æï¼ˆè¯»å–ä»£ç ã€æœç´¢ï¼‰</li>
                    <li>æœ¬åœ° Git æ“ä½œ</li>
                    <li>æœ¬åœ° Office æ–‡æ¡£ç”Ÿæˆï¼ˆä¿å­˜åˆ°æœ¬åœ°ï¼‰</li>
                    <li>æœ¬åœ°å¼€å‘æœåŠ¡å™¨å¯åŠ¨/ç®¡ç†</li>
                </ul>
            </div>
            <div class="tip-box warning">
                <h5>ä¸é€šè¿‡ Client Agent çš„åœºæ™¯</h5>
                <ul>
                    <li>RPA æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆåœ¨æœåŠ¡å™¨æ‰§è¡Œï¼‰</li>
                    <li>å®šæ—¶ä»»åŠ¡ï¼ˆåœ¨æœåŠ¡å™¨æ‰§è¡Œï¼‰</li>
                    <li>è·¨æœåŠ¡å™¨ç›‘ç®¡ï¼ˆé€šè¿‡ Sentinel Agentï¼‰</li>
                    <li>æŸ¥è¯¢ä¸šåŠ¡ç³»ç»Ÿæ•°æ®ï¼ˆç›´æ¥ API è°ƒç”¨ï¼‰</li>
                </ul>
            </div>
        </div>
    </div>

    <h3>ä¹ã€Office åŠå…¬æœ¬åœ°æ”¯æŒ</h3>

    <h4>9.1 è®¾è®¡åŸåˆ™</h4>
    <p>Office æ–‡æ¡£ç”Ÿæˆèƒ½åŠ›ï¼ˆWordã€Excelã€PPTï¼‰ä¿ç•™åœ¨æœåŠ¡å™¨ç«¯ LSC-AI Core ä¸­ï¼Œé€šè¿‡ Client Agent çš„<strong>äºŒè¿›åˆ¶æ–‡ä»¶å†™å…¥</strong>èƒ½åŠ›å°†ç”Ÿæˆçš„æ–‡æ¡£ä¿å­˜åˆ°ç”¨æˆ·æœ¬åœ°ã€‚</p>
    <div class="tip-box info">
        <h5>ä¸ºä»€ä¹ˆä¸åœ¨ Client Agent ä¸­é›†æˆ Office ç”Ÿæˆèƒ½åŠ›ï¼Ÿ</h5>
        <ul>
            <li><strong>ä¿æŒè½»é‡</strong>ï¼šClient Agent ä¿æŒå°å·§ï¼Œæ— éœ€å®‰è£… docx/exceljs/pptxgenjs ç­‰ä¾èµ–</li>
            <li><strong>ç»Ÿä¸€å‡çº§</strong>ï¼šOffice å·¥å…·å‡çº§åªéœ€æ›´æ–°æœåŠ¡å™¨ï¼Œæ— éœ€ç”¨æˆ·é‡è£… Client</li>
            <li><strong>èƒ½åŠ›é›†ä¸­</strong>ï¼šæ‰€æœ‰ AI èƒ½åŠ›é›†ä¸­åœ¨æœåŠ¡å™¨ï¼Œä¾¿äºç®¡ç†å’Œç›‘æ§</li>
        </ul>
    </div>

    <h4>9.2 å·¥ä½œæµç¨‹</h4>
    <div class="mermaid">
sequenceDiagram
    participant User as ç”¨æˆ·æµè§ˆå™¨
    participant Server as LSC-AI æœåŠ¡å™¨
    participant Core as LSC-AI Core
    participant Agent as Client Agent
    participant Local as æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

    User->>Server: "å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªé”€å”®æŠ¥è¡¨ Excelï¼Œä¿å­˜åˆ°æ¡Œé¢"
    Server->>Core: è°ƒç”¨ CreateExcelTool
    Note over Core: åœ¨å†…å­˜ä¸­ç”Ÿæˆ Excel æ–‡ä»¶<br/>(ä¸è½ç›˜åˆ°æœåŠ¡å™¨)
    Core-->>Server: è¿”å› Buffer
    Server->>Server: Base64 ç¼–ç 
    Server->>Agent: file:write:binary æŒ‡ä»¤
    Note right of Agent: payload: {<br/>  path: "C:/Users/xxx/Desktop/é”€å”®æŠ¥è¡¨.xlsx",<br/>  content: "base64...",<br/>  openAfterWrite: true<br/>}
    Agent->>Local: è§£ç å¹¶å†™å…¥æ–‡ä»¶
    Agent->>Local: è°ƒç”¨ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶
    Local-->>User: Excel è‡ªåŠ¨æ‰“å¼€
    Agent-->>Server: å†™å…¥æˆåŠŸ
    Server-->>User: "å·²åœ¨æ‚¨çš„æ¡Œé¢ç”Ÿæˆå¹¶æ‰“å¼€ é”€å”®æŠ¥è¡¨.xlsx"
    </div>

    <h4>9.3 æŒ‡ä»¤æ ¼å¼</h4>
    <pre><code>// äºŒè¿›åˆ¶æ–‡ä»¶å†™å…¥æŒ‡ä»¤
{
  id: "cmd_123",
  type: "file:write:binary",
  payload: {
    path: "C:/Users/å¼ ä¸‰/Desktop/é”€å”®æŠ¥è¡¨.xlsx",
    content: "UEsDBBQAAAAIAM...",  // Base64 ç¼–ç çš„æ–‡ä»¶å†…å®¹
    openAfterWrite: true           // å†™å…¥åè‡ªåŠ¨æ‰“å¼€ï¼ˆå¯é€‰ï¼‰
  }
}

// Client Agent å¤„ç†é€»è¾‘
async function handleWriteBinary(payload) {
  const buffer = Buffer.from(payload.content, 'base64');
  await fs.writeFile(payload.path, buffer);

  if (payload.openAfterWrite) {
    // ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åºæ‰“å¼€
    const { exec } = require('child_process');
    if (process.platform === 'win32') {
      exec(`start "" "${payload.path}"`);
    } else if (process.platform === 'darwin') {
      exec(`open "${payload.path}"`);
    } else {
      exec(`xdg-open "${payload.path}"`);
    }
  }

  return { success: true, path: payload.path };
}</code></pre>

    <h4>9.4 æ”¯æŒçš„ Office æ“ä½œ</h4>
    <table>
        <thead><tr><th>æ“ä½œ</th><th>æœåŠ¡å™¨ç«¯</th><th>Client Agent</th><th>è¯´æ˜</th></tr></thead>
        <tbody>
            <tr><td>åˆ›å»º Word</td><td>CreateWordTool ç”Ÿæˆ</td><td>file:write:binary å†™å…¥</td><td>æ”¯æŒ</td></tr>
            <tr><td>åˆ›å»º Excel</td><td>CreateExcelTool ç”Ÿæˆ</td><td>file:write:binary å†™å…¥</td><td>æ”¯æŒ</td></tr>
            <tr><td>åˆ›å»º PPT</td><td>CreatePPTTool ç”Ÿæˆ</td><td>file:write:binary å†™å…¥</td><td>æ”¯æŒ</td></tr>
            <tr><td>ç¼–è¾‘ Excel</td><td>EditExcelTool å¤„ç†</td><td>file:read + file:write:binary</td><td>æ”¯æŒ</td></tr>
            <tr><td>ç¼–è¾‘ Word</td><td>EditWordTool å¤„ç†</td><td>file:read + file:write:binary</td><td>æ”¯æŒ</td></tr>
            <tr><td>æ‰“å¼€æ–‡ä»¶</td><td>-</td><td>file:open</td><td>æ”¯æŒ</td></tr>
        </tbody>
    </table>

    <h4>9.5 ç¼–è¾‘ç°æœ‰æ–‡æ¡£çš„æµç¨‹</h4>
    <div class="arch-diagram">
        <div class="arch-title">ç¼–è¾‘ç”¨æˆ·æœ¬åœ° Excel çš„æµç¨‹</div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap;">
            <div class="arch-box" style="min-width: 120px;">
                <div class="arch-box-title">1. è¯»å–</div>
                <div class="arch-box-desc">file:read:binary<br/>ä»æœ¬åœ°è¯»å– Excel</div>
            </div>
            <div class="connector">â†’</div>
            <div class="arch-box primary" style="min-width: 120px;">
                <div class="arch-box-title">2. ä¸Šä¼ </div>
                <div class="arch-box-desc">Base64 ä¼ è¾“åˆ°æœåŠ¡å™¨</div>
            </div>
            <div class="connector">â†’</div>
            <div class="arch-box warning" style="min-width: 120px;">
                <div class="arch-box-title">3. ç¼–è¾‘</div>
                <div class="arch-box-desc">EditExcelTool<br/>åœ¨æœåŠ¡å™¨ä¿®æ”¹</div>
            </div>
            <div class="connector">â†’</div>
            <div class="arch-box success" style="min-width: 120px;">
                <div class="arch-box-title">4. å†™å›</div>
                <div class="arch-box-desc">file:write:binary<br/>ä¿å­˜å›æœ¬åœ°</div>
            </div>
        </div>
    </div>

    <h3>åã€å¼€å‘è®¡åˆ’</h3>

    <table>
        <thead><tr><th>é˜¶æ®µ</th><th>å†…å®¹</th><th>é¢„è®¡å‘¨æœŸ</th></tr></thead>
        <tbody>
            <tr><td><strong>Phase 1</strong></td><td>åŸºç¡€é€šä¿¡æ¡†æ¶ã€æ–‡ä»¶è¯»å†™</td><td>1-2 å‘¨</td></tr>
            <tr><td><strong>Phase 2</strong></td><td>å‘½ä»¤æ‰§è¡Œã€æœç´¢åŠŸèƒ½</td><td>1 å‘¨</td></tr>
            <tr><td><strong>Phase 3</strong></td><td>å®‰å…¨æœºåˆ¶ã€ç”¨æˆ·ç¡®è®¤</td><td>1 å‘¨</td></tr>
            <tr><td><strong>Phase 4</strong></td><td>äºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒã€Office é›†æˆ</td><td>1 å‘¨</td></tr>
            <tr><td><strong>Phase 5</strong></td><td>æ‰“åŒ…åˆ†å‘ã€å®‰è£…å¼•å¯¼</td><td>1 å‘¨</td></tr>
            <tr><td><strong>Phase 6</strong></td><td>å†…æ ¸é›†æˆã€æµ‹è¯•</td><td>1-2 å‘¨</td></tr>
        </tbody>
    </table>
    <p style="margin-top: 16px; text-align: center; color: var(--text-secondary);"><strong>æ€»è®¡ï¼šçº¦ 6-8 å‘¨</strong></p>

</div>

<script>
    mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
</script>
</body>
</html>
