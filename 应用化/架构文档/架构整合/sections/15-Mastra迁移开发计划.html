<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 - Mastra 迁移开发计划</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="../assets/mermaid.min.js"></script>
</head>
<body>
<div class="section-page">
    <div class="section-header">
        <h2>15 - Mastra 迁移开发计划</h2>
        <div class="meta">文档版本：3.0 | 更新日期：2026-02-10 | 作者：lsc0103</div>
    </div>

    <div class="tip-box success" style="border-color: #52c41a; background: #f6ffed;">
        <strong>开发周期：</strong>14 个工作日 (约 3 周)
        <br/>
        <strong>计划开始：</strong>2026-01-28
        <br/>
        <strong>预计完成：</strong>2026-02-18
        <br/><br/>
        <strong style="color: #52c41a;">实际进度（截至 2026-02-10）：Phase 1-4 已全部完成，Phase 5 测试验证已完成（Phase H 深度验收 43/43 通过）。Sentinel Agent 待独立开发。</strong>
    </div>

    <div class="tip-box success" style="border-color: #52c41a; background: #f6ffed; margin-bottom: 20px;">
        <h5 style="margin-bottom: 12px; color: #52c41a;">实际完成情况（2026-01-28 ~ 02-10，14天）</h5>
        <table style="margin: 0;">
            <thead><tr><th>Phase</th><th>计划</th><th>实际状态</th><th>说明</th></tr></thead>
            <tbody>
                <tr><td><strong>Phase 1: 基础框架</strong></td><td>2天</td><td><span class="status-badge status-done">已完成</span></td><td>Mastra 依赖安装、MastraAgentService 创建、ChatModule 集成</td></tr>
                <tr><td><strong>Phase 2: 工具迁移</strong></td><td>3天</td><td><span class="status-badge status-done">已完成</span></td><td>35+ 工具全部迁移为 Mastra Tool 格式（Zod Schema）+ Workbench 4 工具全面重写</td></tr>
                <tr><td><strong>Phase 3: Memory 升级</strong></td><td>2天</td><td><span class="status-badge status-done">已完成</span></td><td>LibSQL 存储 + Memory recall() + Working Memory + 线程清理 + 语义搜索(fastembed)</td></tr>
                <tr><td><strong>Phase 4: Agent 替换</strong></td><td>4天</td><td><span class="status-badge status-done">已完成</span></td><td>Platform Agent 4 个 + Client Agent Mastra 迁移 + 10 个 P0 Bug 修复；Sentinel Agent 待独立开发</td></tr>
                <tr><td><strong>Phase 5: 测试验证</strong></td><td>3天</td><td><span class="status-badge status-done">已完成</span></td><td>Phase H 深度产品验收 43/43 通过（240+ E2E 测试用例），PM 签字确认</td></tr>
            </tbody>
        </table>
        <p style="margin-top: 12px;"><strong>额外完成（超出原计划）：</strong></p>
        <ul style="margin: 0; padding-left: 20px;">
            <li>AgentNetwork 多 Agent 协作（原计划 V2 阶段）</li>
            <li>Mastra Workflow 引擎集成（原计划 V2 阶段）</li>
            <li>Working Memory 持久化上下文（原计划未包含）</li>
            <li>Workbench 持久化完全重构（useSessionWorkbench 重写）</li>
            <li>混合存储策略确定（PostgreSQL + LibSQL + MinIO + Redis）</li>
        </ul>
    </div>

    <h3>一、总体进度规划</h3>

    <h4>1.1 Gantt 甘特图</h4>
    <div class="mermaid">
gantt
    title Mastra 框架迁移开发计划
    dateFormat  YYYY-MM-DD
    section Phase 1 基础框架
    安装 Mastra 依赖           :p1-1, 2026-01-28, 1d
    重构 AgentService          :p1-2, after p1-1, 1d

    section Phase 2 工具迁移
    提取 LSC Office 工具       :p2-1, after p1-2, 1d
    转换 Mastra Tool 格式      :p2-2, after p2-1, 1d
    验证工具调用               :p2-3, after p2-2, 1d

    section Phase 3 Memory 升级
    配置 LibSQL 存储           :p3-1, after p2-3, 1d
    迁移对话历史               :p3-2, after p3-1, 1d

    section Phase 4 Agent 替换
    Platform Agent 升级        :p4-1, after p3-2, 2d
    Client Agent 升级          :p4-2, after p4-1, 1d
    Sentinel Agent 升级        :p4-3, after p4-2, 1d

    section Phase 5 测试验证
    功能回归测试               :p5-1, after p4-3, 1d
    性能压力测试               :p5-2, after p5-1, 1d
    生产环境验证               :p5-3, after p5-2, 1d
    </div>

    <h4>1.2 里程碑</h4>
    <table>
        <thead>
            <tr><th>里程碑</th><th>完成标准</th><th>预计日期</th><th>实际状态</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>M1: 基础框架就绪</strong></td>
                <td>Mastra + DeepSeek 基础对话可用</td>
                <td>2026-01-30</td>
                <td><span class="status-badge status-done">✅ 01-28 完成</span></td>
            </tr>
            <tr>
                <td><strong>M2: 工具集成完成</strong></td>
                <td>LSC Office 工具在 Mastra 中可调用</td>
                <td>2026-02-04</td>
                <td><span class="status-badge status-done">✅ 01-28 完成</span></td>
            </tr>
            <tr>
                <td><strong>M3: Memory 升级完成</strong></td>
                <td>对话历史正确持久化到 LibSQL + Working Memory</td>
                <td>2026-02-06</td>
                <td><span class="status-badge status-done">✅ 01-29 完成</span></td>
            </tr>
            <tr>
                <td><strong>M4: Agent 全面升级</strong></td>
                <td>三种 Agent 全部基于 Mastra 运行</td>
                <td>2026-02-13</td>
                <td><span class="status-badge status-done">✅ 02-07 Platform + Client 完成</span></td>
            </tr>
            <tr>
                <td><strong>M5: 生产就绪</strong></td>
                <td>所有测试通过，可上线生产</td>
                <td>2026-02-18</td>
                <td><span class="status-badge status-done">✅ 02-10 Phase H 43/43 通过</span></td>
            </tr>
        </tbody>
    </table>

    <h3>二、Phase 1: 基础框架迁移 (2天)</h3>

    <h4>2.1 Day 1: 安装依赖和项目结构调整</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>1.1 安装 Mastra 依赖</strong></td>
                <td>
                    在 lsc-ai-platform/server 中安装：<br/>
                    <code>npm install @mastra/core @mastra/memory @mastra/libsql @ai-sdk/deepseek zod</code>
                </td>
                <td>✅ package.json 更新</td>
            </tr>
            <tr>
                <td><strong>1.2 创建目录结构</strong></td>
                <td>
                    <pre style="font-size: 12px;">
src/
├── agents/
│   ├── platform-agent.ts    # Platform Agent
│   ├── client-agent.ts      # Client Agent
│   └── sentinel-agent.ts    # Sentinel Agent
├── tools/
│   ├── office/              # Office 工具
│   ├── file/                # 文件工具
│   └── system/              # 系统工具
└── services/
    └── agent.service.ts     # Agent 服务层</pre>
                </td>
                <td>✅ 目录创建完成</td>
            </tr>
            <tr>
                <td><strong>1.3 配置环境变量</strong></td>
                <td>
                    在 .env 中添加：<br/>
                    <code>DEEPSEEK_API_KEY=xxx</code><br/>
                    <code>LIBSQL_URL=file:./data/lsc-ai.db</code>
                </td>
                <td>✅ .env 配置</td>
            </tr>
        </tbody>
    </table>

    <h4>2.2 Day 2: 重构 AgentService</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>2.1 创建 AgentService</strong></td>
                <td>
                    参考 PoC 实现，创建 <code>src/services/agent.service.ts</code>：<br/>
                    • 初始化 LibSQL 存储<br/>
                    • 创建 Memory 实例<br/>
                    • 注册三种 Agent<br/>
                    • 提供 chat() 和 chatStream() 方法
                </td>
                <td>✅ agent.service.ts</td>
            </tr>
            <tr>
                <td><strong>2.2 更新 ChatModule</strong></td>
                <td>
                    在 ChatModule 中注入 AgentService：<br/>
                    • 替换原 @lsc-ai/core 调用<br/>
                    • 使用 AgentService.chatStream()<br/>
                    • 保持 WebSocket 接口不变
                </td>
                <td>✅ chat.module.ts<br/>✅ chat.gateway.ts</td>
            </tr>
            <tr>
                <td><strong>2.3 基础测试</strong></td>
                <td>
                    验证基础对话能力：<br/>
                    • 浏览器连接 WebSocket<br/>
                    • 发送简单问题<br/>
                    • 收到流式响应
                </td>
                <td>✅ 基础对话正常</td>
            </tr>
        </tbody>
    </table>

    <div class="tip-box success">
        <strong>Phase 1 完成标志：</strong>用户可以在浏览器中与 Mastra Agent 进行基础对话，无工具调用。
    </div>

    <h3>三、Phase 2: 工具迁移 (3天)</h3>

    <h4>3.1 Day 3: 提取 LSC Office 工具</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>工具清单</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>3.1 提取工具代码</strong></td>
                <td>
                    从 @lsc-ai/core 提取：<br/>
                    • Word 文档工具 (docx)<br/>
                    • Excel 工具 (xlsx)<br/>
                    • PowerPoint 工具<br/>
                    • PDF 工具<br/>
                    • 文件操作工具<br/>
                    • 项目检测工具
                </td>
                <td>✅ src/tools/office/*<br/>✅ src/tools/file/*</td>
            </tr>
            <tr>
                <td><strong>3.2 保留工具逻辑</strong></td>
                <td>
                    工具核心逻辑不变，仅修改：<br/>
                    • 移除 @lsc-ai/core 依赖<br/>
                    • 独立 npm 包安装 (docx, xlsx 等)
                </td>
                <td>✅ 工具逻辑完整</td>
            </tr>
        </tbody>
    </table>

    <h4>3.2 Day 4: 转换 Mastra Tool 格式</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>示例</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>4.1 定义 Zod Schema</strong></td>
                <td>
                    为每个工具定义输入输出 Schema
                </td>
                <td>
<pre style="font-size: 11px;">import { createTool } from "@mastra/core/tools";
import { z } from "zod";

export const readWordTool = createTool({
  id: "read-word",
  description: "读取 Word 文档内容",
  inputSchema: z.object({
    filePath: z.string()
  }),
  outputSchema: z.object({
    success: z.boolean(),
    content: z.string().optional(),
    error: z.string().optional()
  }),
  execute: async ({ filePath }) => {
    // 原工具逻辑
  }
});</pre>
                </td>
            </tr>
            <tr>
                <td><strong>4.2 批量转换工具</strong></td>
                <td>
                    将所有 LSC 工具转换为 Mastra 格式：<br/>
                    • 文件工具 (~10个)<br/>
                    • Office 工具 (~8个)<br/>
                    • 系统工具 (~5个)
                </td>
                <td>✅ 23 个工具转换完成</td>
            </tr>
        </tbody>
    </table>

    <h4>3.3 Day 5: 验证工具调用</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>测试用例</th><th>通过标准</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>5.1 单元测试</strong></td>
                <td>
                    • 文件读写工具<br/>
                    • Word 文档读取<br/>
                    • Excel 表格操作<br/>
                    • PDF 提取
                </td>
                <td>✅ 所有工具单测通过</td>
            </tr>
            <tr>
                <td><strong>5.2 集成测试</strong></td>
                <td>
                    • Agent 调用工具<br/>
                    • 工具参数解析<br/>
                    • 错误处理<br/>
                    • 返回值验证
                </td>
                <td>✅ Agent 工具调用正常</td>
            </tr>
        </tbody>
    </table>

    <div class="tip-box success">
        <strong>Phase 2 完成标志：</strong>Agent 可以正确调用所有 LSC Office 工具，工具执行结果符合预期。
    </div>

    <h3>四、Phase 3: Memory 升级 (2天)</h3>

    <h4>4.1 Day 6: 配置 LibSQL 存储</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>6.1 LibSQL 存储配置</strong></td>
                <td>
<pre style="font-size: 11px;">import { LibSQLStore } from "@mastra/libsql";

const storage = new LibSQLStore({
  id: "lsc-ai-storage",
  url: process.env.LIBSQL_URL,
});

const memory = new Memory({
  storage,
  options: {
    lastMessages: 50,
  },
});</pre>
                </td>
                <td>✅ storage 配置</td>
            </tr>
            <tr>
                <td><strong>6.2 数据库初始化</strong></td>
                <td>
                    • 创建 LibSQL 数据库文件<br/>
                    • 初始化 Memory 表结构<br/>
                    • 配置自动备份
                </td>
                <td>✅ data/lsc-ai.db</td>
            </tr>
        </tbody>
    </table>

    <h4>4.2 Day 7: 迁移对话历史</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>7.1 Thread 管理</strong></td>
                <td>
                    • 每个会话对应一个 Thread<br/>
                    • Thread ID 生成规则<br/>
                    • Resource ID (用户 ID) 关联
                </td>
                <td>✅ Thread 管理策略</td>
            </tr>
            <tr>
                <td><strong>7.2 对话历史持久化</strong></td>
                <td>
<pre style="font-size: 11px;">const result = await agent.generate(message, {
  memory: {
    thread: sessionId,
    resource: userId,
  },
});</pre>
                </td>
                <td>✅ 对话历史存储</td>
            </tr>
            <tr>
                <td><strong>7.3 历史回溯测试</strong></td>
                <td>
                    • 多轮对话记忆<br/>
                    • 跨会话记忆隔离<br/>
                    • 长对话性能
                </td>
                <td>✅ Memory 测试通过</td>
            </tr>
        </tbody>
    </table>

    <div class="tip-box success">
        <strong>Phase 3 完成标志：</strong>对话历史正确持久化到 LibSQL，多轮对话记忆正常，不同会话记忆隔离。
    </div>

    <h3>五、Phase 4: Agent 替换 (4天)</h3>

    <h4>5.1 Day 8-9: Platform Agent 升级</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>工期</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>8.1 创建 Platform Agent</strong></td>
                <td>
<pre style="font-size: 11px;">export const platformAgent = new Agent({
  name: "platform-agent",
  instructions: `你是 LSC-AI 平台助手...`,
  model: deepseek("deepseek-chat"),
  memory,
  tools: {
    // 注册所有工具
    ...fileTools,
    ...officeTools,
    ...systemTools,
  },
});</pre>
                </td>
                <td>1 天</td>
            </tr>
            <tr>
                <td><strong>8.2 集成 Workbench</strong></td>
                <td>
                    • 创建 Workbench Tool<br/>
                    • Schema 生成逻辑<br/>
                    • WebSocket 推送
                </td>
                <td>0.5 天</td>
            </tr>
            <tr>
                <td><strong>8.3 RPA/定时任务</strong></td>
                <td>
                    • TaskModule 使用 Platform Agent<br/>
                    • RPAModule 使用 Platform Agent<br/>
                    • 验证任务执行
                </td>
                <td>0.5 天</td>
            </tr>
        </tbody>
    </table>

    <h4>5.2 Day 10: Client Agent 升级</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>工期</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>10.1 Client Agent 迁移</strong></td>
                <td>
                    在 client-agent 项目中：<br/>
                    • 安装 Mastra 依赖<br/>
                    • 创建本地 Agent<br/>
                    • 配置本地 Memory (SQLite)
                </td>
                <td>0.5 天</td>
            </tr>
            <tr>
                <td><strong>10.2 本地工具集成</strong></td>
                <td>
                    • 文件系统工具<br/>
                    • Office 工具 (完整)<br/>
                    • 开发工具 (Git, NPM)
                </td>
                <td>0.3 天</td>
            </tr>
            <tr>
                <td><strong>10.3 WebSocket 通信</strong></td>
                <td>
                    • 保持与平台的 WebSocket 连接<br/>
                    • 接收任务指令<br/>
                    • 执行并返回结果
                </td>
                <td>0.2 天</td>
            </tr>
        </tbody>
    </table>

    <h4>5.3 Day 11: Sentinel Agent 升级</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>工期</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>11.1 Sentinel Agent 迁移</strong></td>
                <td>
                    在 sentinel-agent 项目中：<br/>
                    • 安装 Mastra 依赖<br/>
                    • 创建 Sentinel Agent<br/>
                    • 配置系统监控工具
                </td>
                <td>0.5 天</td>
            </tr>
            <tr>
                <td><strong>11.2 运维工具集成</strong></td>
                <td>
                    • 系统状态监控<br/>
                    • 服务管理工具<br/>
                    • 日志分析工具<br/>
                    • Docker 操作工具
                </td>
                <td>0.3 天</td>
            </tr>
            <tr>
                <td><strong>11.3 自动化决策</strong></td>
                <td>
                    • 异常检测与告警<br/>
                    • 自动修复逻辑<br/>
                    • 运维报告生成
                </td>
                <td>0.2 天</td>
            </tr>
        </tbody>
    </table>

    <div class="tip-box success">
        <strong>Phase 4 完成标志：</strong>三种 Agent 全部基于 Mastra 运行，功能与原 @lsc-ai/core 版本等价。
    </div>

    <h3>六、Phase 5: 测试验证 (3天)</h3>

    <h4>6.1 Day 12: 功能回归测试</h4>
    <table>
        <thead>
            <tr><th>测试模块</th><th>测试用例</th><th>通过标准</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>对话功能</strong></td>
                <td>
                    • 基础对话<br/>
                    • 多轮对话<br/>
                    • 记忆回溯<br/>
                    • 流式输出
                </td>
                <td>✅ 所有用例通过</td>
            </tr>
            <tr>
                <td><strong>工具调用</strong></td>
                <td>
                    • 文件操作 (10+ 工具)<br/>
                    • Office 工具 (8+ 工具)<br/>
                    • 系统工具 (5+ 工具)<br/>
                    • 错误处理
                </td>
                <td>✅ 工具调用成功率 100%</td>
            </tr>
            <tr>
                <td><strong>Workbench</strong></td>
                <td>
                    • 代码展示<br/>
                    • 数据表格<br/>
                    • 图表渲染<br/>
                    • 多标签页
                </td>
                <td>✅ Schema 输出正确</td>
            </tr>
            <tr>
                <td><strong>RPA/定时任务</strong></td>
                <td>
                    • 定时任务调度<br/>
                    • RPA 流程执行<br/>
                    • 任务状态推送
                </td>
                <td>✅ 任务执行正常</td>
            </tr>
            <tr>
                <td><strong>Client Agent</strong></td>
                <td>
                    • 本地文件操作<br/>
                    • Office 办公自动化<br/>
                    • 实时通信
                </td>
                <td>✅ 本地 Agent 正常</td>
            </tr>
        </tbody>
    </table>

    <h4>6.2 Day 13: 性能压力测试</h4>
    <table>
        <thead>
            <tr><th>测试项</th><th>测试指标</th><th>目标值</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>并发对话</strong></td>
                <td>同时 100 个用户对话</td>
                <td>响应时间 < 2s</td>
            </tr>
            <tr>
                <td><strong>Memory 性能</strong></td>
                <td>10000 条对话历史查询</td>
                <td>查询时间 < 100ms</td>
            </tr>
            <tr>
                <td><strong>工具调用</strong></td>
                <td>1000 次工具调用</td>
                <td>成功率 > 99.9%</td>
            </tr>
            <tr>
                <td><strong>WebSocket</strong></td>
                <td>持续 1000 个连接 1 小时</td>
                <td>无断线</td>
            </tr>
        </tbody>
    </table>

    <h4>6.3 Day 14: 生产环境验证</h4>
    <table>
        <thead>
            <tr><th>任务</th><th>详细内容</th><th>产出</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>14.1 预发布部署</strong></td>
                <td>
                    • 部署到预发布环境<br/>
                    • 配置生产级 LibSQL<br/>
                    • 配置监控告警
                </td>
                <td>✅ 预发布环境就绪</td>
            </tr>
            <tr>
                <td><strong>14.2 用户验收测试</strong></td>
                <td>
                    • 邀请 5-10 个内部用户<br/>
                    • 真实场景测试<br/>
                    • 收集反馈
                </td>
                <td>✅ UAT 通过</td>
            </tr>
            <tr>
                <td><strong>14.3 上线准备</strong></td>
                <td>
                    • 数据备份方案<br/>
                    • 回滚方案<br/>
                    • 上线 checklist
                </td>
                <td>✅ 上线文档</td>
            </tr>
        </tbody>
    </table>

    <div class="tip-box success">
        <strong>Phase 5 完成标志：</strong>所有测试通过，性能达标，用户验收满意，可上线生产环境。
    </div>

    <h3>七、风险与应对</h3>

    <h4>7.1 技术风险</h4>
    <table>
        <thead>
            <tr><th>风险</th><th>概率</th><th>影响</th><th>应对措施</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>工具 API 兼容性问题</td>
                <td>中</td>
                <td>高</td>
                <td>保留适配层，逐步迁移；充分测试</td>
            </tr>
            <tr>
                <td>Memory 数据丢失</td>
                <td>低</td>
                <td>高</td>
                <td>做好数据备份；先在测试环境验证</td>
            </tr>
            <tr>
                <td>性能不达标</td>
                <td>低</td>
                <td>中</td>
                <td>性能基准测试；必要时优化</td>
            </tr>
            <tr>
                <td>Agent 行为差异</td>
                <td>中</td>
                <td>中</td>
                <td>A/B 测试对比；Prompt 优化</td>
            </tr>
        </tbody>
    </table>

    <h4>7.2 进度风险</h4>
    <table>
        <thead>
            <tr><th>风险</th><th>应对措施</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>工具迁移工作量超预期</td>
                <td>优先迁移核心工具，非核心工具延后</td>
            </tr>
            <tr>
                <td>测试发现重大 Bug</td>
                <td>预留 2 天 buffer 时间</td>
            </tr>
            <tr>
                <td>依赖阻塞</td>
                <td>提前准备，确保环境和依赖就绪</td>
            </tr>
        </tbody>
    </table>

    <h3>八、质量保证</h3>

    <h4>8.1 Code Review 要求</h4>
    <ul>
        <li>所有代码必须通过 Code Review</li>
        <li>关键模块双人 Review</li>
        <li>遵循 TypeScript 最佳实践</li>
        <li>必须有充分的注释</li>
    </ul>

    <h4>8.2 测试覆盖率</h4>
    <ul>
        <li>工具层：单元测试覆盖率 > 80%</li>
        <li>服务层：集成测试覆盖核心流程</li>
        <li>Agent 层：端到端测试覆盖主要场景</li>
    </ul>

    <h4>8.3 文档要求</h4>
    <ul>
        <li>每个工具必须有完整的 JSDoc</li>
        <li>每个 Agent 必须有使用说明</li>
        <li>更新架构文档和部署文档</li>
        <li>编写迁移指南</li>
    </ul>

    <h3>九、后续优化</h3>

    <div class="tip-box info">
        <h5>后续优化计划（按优先级排序）</h5>
        <p style="margin-bottom: 8px;"><strong>P0 - 核心功能完善</strong></p>
        <ul>
            <li><strong>清理 Prisma Message 死代码</strong> - Message 模型已废弃，代码不再写入，需移除或标注</li>
            <li><strong>语义搜索 / RAG</strong> - LibSQLVector 向量存储 + Memory semanticRecall，提升对话上下文质量</li>
        </ul>
        <p style="margin-bottom: 8px;"><strong>P1 - 功能闭环</strong></p>
        <ul>
            <li><strong>Workflow / RPA 前端入口</strong> - Controller + API + 前端界面</li>
            <li><strong>定时任务调度器</strong> - @nestjs/schedule 集成</li>
            <li><strong>Client Agent 迁移到 Mastra</strong> - 统一架构</li>
        </ul>
        <p style="margin-bottom: 8px;"><strong>P2 - 体验优化</strong></p>
        <ul>
            <li><strong>Observability</strong> - Mastra 分布式追踪、性能监控</li>
            <li><strong>AgentNetwork 路由优化</strong> - 正式路由策略（替代提示词路由）</li>
        </ul>
        <p style="margin-bottom: 8px;"><strong>P3 - 远期</strong></p>
        <ul>
            <li><s>Workflow 编排</s> <span style="color: #52c41a;">✅ 已提前完成</span></li>
            <li><s>Multi-Agent</s> <span style="color: #52c41a;">✅ 已提前完成（AgentNetwork）</span></li>
            <li><strong>Evals / 质量评分</strong> - Agent 回复质量自动评估</li>
            <li><strong>MCP Server</strong> - 将平台 Agent 暴露为 MCP 服务</li>
            <li><strong>Thread Cloning</strong> - 从已有对话分叉新对话</li>
        </ul>
    </div>

    <h3>十、总结</h3>

    <div class="tip-box success">
        <h5>开发计划总结</h5>
        <ul>
            <li><strong>总工期：</strong>14 个工作日 (约 3 周)</li>
            <li><strong>团队规模：</strong>1-2 名开发者</li>
            <li><strong>风险等级：</strong>中等（有 PoC 验证，有回滚方案）</li>
            <li><strong>预期收益：</strong>成熟度提升 2.5 倍，维护成本降低 80%</li>
        </ul>
    </div>
</div>

<script>
    mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
</script>
</body>
</html>
